<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nosso Controle - Família Oliveira</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF7A5A;
            --primary-light: #FF9A7A;
            --primary-dark: #E56A4A;
            --secondary: #6A4CFF;
            --green: #2ECC71;
            --yellow: #F1C40F;
            --purple: #9B59B6;
            --blue: #3498DB;
            --dark: #2C3E50;
            --light: #F8F9FA;
            --gray: #95A5A6;
            --gray-bg: #F0F2F5;
            --gray-light: #ECF0F1;
            --border-radius: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-bg);
            color: var(--dark);
            min-height: 100vh;
        }

        /* Header Mobile */
        .header-mobile {
            background: white;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--primary);
            cursor: pointer;
            padding: 8px;
            z-index: 1002;
        }

        .logo-mobile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 20px;
            color: var(--primary);
        }

        .user-avatar-mobile {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            position: relative;
        }

        /* Menu Lateral Mobile */
        .sidebar-mobile {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transition: var(--transition);
            overflow-y: auto;
            padding: 80px 20px 30px;
        }

        .sidebar-mobile.active {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            transition: var(--transition);
        }

        .sidebar-overlay.active {
            display: block;
        }

        .menu-section {
            margin-bottom: 30px;
        }

        .menu-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            color: var(--dark);
        }

        .menu-item:hover {
            background-color: rgba(255, 122, 90, 0.1);
        }

        .menu-item.active {
            background-color: rgba(255, 122, 90, 0.15);
            color: var(--primary);
            font-weight: 500;
            border-left: 4px solid var(--primary);
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--primary);
        }

        .menu-text {
            font-size: 15px;
            font-weight: 500;
        }

        /* Conteúdo Principal */
        .main-content {
            padding: 100px 20px 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .page-title {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .page-subtitle {
            color: var(--gray);
            margin-bottom: 25px;
            font-size: 15px;
        }

        /* Cards de Resumo */
        .summary-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .summary-cards {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .summary-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-top: 4px solid var(--primary);
        }

        .summary-card:hover {
            transform: translateY(-3px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--dark);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }

        .icon-income {
            background: linear-gradient(135deg, var(--green), #27AE60);
        }

        .icon-expense {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .icon-balance {
            background: linear-gradient(135deg, var(--secondary), #8B7AFF);
        }

        .card-amount {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .income-amount {
            color: var(--green);
        }

        .expense-amount {
            color: var(--primary);
        }

        .balance-amount {
            color: var(--secondary);
        }

        .card-footer {
            font-size: 13px;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Gastos por Pessoa */
        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .add-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: var(--transition);
        }

        .add-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .people-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .people-cards {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .person-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 18px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
            border-left: 4px solid var(--primary);
        }

        .person-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 20px;
            color: white;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }

        .avatar-fabiana {
            background: linear-gradient(135deg, var(--purple), #8E44AD);
        }

        .avatar-marcos {
            background: linear-gradient(135deg, var(--blue), #2980B9);
        }

        .avatar-family {
            background: linear-gradient(135deg, var(--green), #27AE60);
        }

        .person-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .person-expense {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .person-tags {
            font-size: 12px;
            color: var(--gray);
        }

        /* Categorias */
        .categories {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .categories {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .category-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 18px;
            box-shadow: var(--shadow);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }

        .icon-food {
            background: linear-gradient(135deg, #FF7A5A, #FF9A7A);
        }

        .icon-home {
            background: linear-gradient(135deg, #6A4CFF, #8B7AFF);
        }

        .icon-transport {
            background: linear-gradient(135deg, #3498DB, #5DADE2);
        }

        .category-name {
            font-size: 16px;
            font-weight: 600;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--gray-light);
            border-radius: 4px;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-food {
            width: 0%;
            background: linear-gradient(to right, #FF7A5A, #FF9A7A);
        }

        .progress-home {
            width: 0%;
            background: linear-gradient(to right, #6A4CFF, #8B7AFF);
        }

        .progress-transport {
            width: 0%;
            background: linear-gradient(to right, #3498DB, #5DADE2);
        }

        .category-details {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .category-amount {
            font-weight: 600;
        }

        .category-limit {
            color: var(--gray);
        }

        /* Lançamento de Gastos/Receitas */
        .entry-form {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .transaction-type-toggle {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--gray-light);
        }

        .type-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            background: white;
            color: var(--gray);
        }

        .type-btn.active {
            color: white;
        }

        .type-btn:first-child.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .type-btn:last-child.active {
            background: linear-gradient(135deg, var(--green), #27AE60);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid var(--gray-light);
            font-size: 15px;
            transition: var(--transition);
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 122, 90, 0.2);
        }

        /* Botões de Ação */
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .form-submit {
            flex: 2;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
        }

        .form-submit:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .form-submit.income {
            background: linear-gradient(135deg, var(--green), #27AE60);
        }

        .save-btn {
            flex: 1;
            background: linear-gradient(135deg, var(--secondary), #8B7AFF);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
        }

        .save-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Transações */
        .transactions-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .transaction-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
        }

        .transaction-details h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .transaction-details p {
            font-size: 13px;
            color: var(--gray);
        }

        .transaction-amount {
            font-size: 16px;
            font-weight: 600;
        }

        .amount-expense {
            color: var(--primary);
        }

        .amount-income {
            color: var(--green);
        }

        /* Botões de Ação nas Transações */
        .transaction-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .action-btn {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .edit-btn {
            background: linear-gradient(135deg, var(--blue), #2980B9);
            color: white;
        }

        .delete-btn {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
        }

        /* Seções de Conteúdo */
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Tabela de Detalhamento */
        .details-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .details-table th {
            text-align: left;
            padding: 12px 15px;
            background: var(--gray-light);
            font-size: 14px;
            color: var(--dark);
            border-bottom: 2px solid var(--gray);
        }

        .details-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
            font-size: 14px;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-paid {
            background: rgba(46, 204, 113, 0.1);
            color: var(--green);
        }

        .status-pending {
            background: rgba(241, 196, 15, 0.1);
            color: var(--yellow);
        }

        .status-draft {
            background: rgba(149, 165, 166, 0.1);
            color: var(--gray);
        }

        /* Relatórios */
        .report-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        /* Saldo Positivo/Negativo */
        .positive {
            color: var(--green) !important;
        }

        .negative {
            color: #E74C3C !important;
        }

        /* Categorias de Receita */
        .income-categories {
            display: none;
        }

        /* Rascunhos */
        .drafts-section {
            margin-top: 30px;
        }

        .draft-item {
            background: rgba(106, 76, 255, 0.05);
            border: 1px dashed var(--secondary);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .draft-info h4 {
            font-size: 15px;
            margin-bottom: 5px;
        }

        .draft-info p {
            font-size: 13px;
            color: var(--gray);
        }

        .draft-actions {
            display: flex;
            gap: 10px;
        }

        .draft-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .draft-complete {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .draft-delete {
            background: var(--gray-light);
            color: var(--dark);
        }

        /* Notificações Simples */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: var(--border-radius);
            padding: 12px 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 2000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
            border-left: 4px solid var(--primary);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: var(--green);
        }
        
        .notification.error {
            border-left-color: #E74C3C;
        }
        
        .notification.warning {
            border-left-color: var(--yellow);
        }
        
        .notification-icon {
            font-size: 18px;
        }
        
        .notification.success .notification-icon {
            color: var(--green);
        }
        
        .notification.error .notification-icon {
            color: #E74C3C;
        }
        
        .notification.warning .notification-icon {
            color: var(--yellow);
        }
        
        .notification-content h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .notification-content p {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Status de Armazenamento */
        .storage-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: var(--green);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            transition: var(--transition);
        }
        
        .storage-saving {
            background: var(--yellow);
        }
        
        .storage-error {
            background: #E74C3C;
        }

        /* Modal de Edição */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2001;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-family: 'Poppins', sans-serif;
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
        }
        
        .modal-content {
            padding: 20px;
        }
        
        .modal-actions {
            padding: 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }
        
        .modal-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }
        
        .modal-btn.cancel {
            background: var(--gray-light);
            color: var(--dark);
        }
        
        .modal-btn.save {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .modal-btn.delete {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            color: white;
        }

        /* Modal Rápido */
        .quick-add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 122, 90, 0.4);
            z-index: 999;
            transition: var(--transition);
        }

        .quick-add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255, 122, 90, 0.6);
        }

        .quick-modal {
            max-width: 400px;
        }

        .quick-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .quick-form .form-group {
            margin-bottom: 0;
        }

        .quick-form .form-group:first-child {
            grid-column: span 2;
        }

        .quick-form .form-group:nth-child(2) {
            grid-column: span 1;
        }

        .quick-form .form-group:nth-child(3) {
            grid-column: span 1;
        }

        .quick-form .form-group:nth-child(4) {
            grid-column: span 2;
        }

        .quick-form .form-actions {
            grid-column: span 2;
            margin-top: 10px;
        }

        /* Orçamento Mensal */
        .budget-warning {
            background: rgba(241, 196, 15, 0.1);
            border-left: 4px solid var(--yellow);
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .budget-warning.critical {
            background: rgba(231, 76, 60, 0.1);
            border-left-color: #E74C3C;
        }

        .budget-warning.good {
            background: rgba(46, 204, 113, 0.1);
            border-left-color: var(--green);
        }

        .budget-progress {
            margin-top: 5px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }

        .budget-progress .percentage {
            font-weight: 600;
        }

        .budget-progress .percentage.high {
            color: #E74C3C;
        }

        .budget-progress .percentage.medium {
            color: var(--yellow);
        }

        .budget-progress .percentage.low {
            color: var(--green);
        }

        /* Gráficos */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .charts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .chart-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chart-legend {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Gestão de Usuários */
        .users-management {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .user-manage-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-manage-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }

        .add-user-btn {
            background: var(--gray-light);
            border: 2px dashed var(--gray);
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .add-user-btn:hover {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Badges de Cor */
        .color-badge {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .color-badge.selected {
            border-color: var(--dark);
            transform: scale(1.1);
        }

        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        /* Sincronização */
        .sync-section {
            background: rgba(52, 152, 219, 0.05);
            border: 1px solid rgba(52, 152, 219, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .sync-code {
            font-family: monospace;
            background: var(--dark);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
            font-size: 14px;
        }

        .copy-btn {
            background: var(--gray-light);
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }

        /* Ícones Novos */
        .icon-salary { background: linear-gradient(135deg, #2ECC71, #27AE60); }
        .icon-extra { background: linear-gradient(135deg, #3498DB, #2980B9); }
        .icon-investment { background: linear-gradient(135deg, #9B59B6, #8E44AD); }
        .icon-refund { background: linear-gradient(135deg, #F1C40F, #F39C12); }
        .icon-gift { background: linear-gradient(135deg, #E74C3C, #C0392B); }
        .icon-education { background: linear-gradient(135deg, #1ABC9C, #16A085); }
        .icon-health { background: linear-gradient(135deg, #E67E22, #D35400); }
        .icon-fun { background: linear-gradient(135deg, #F39C12, #E67E22); }
        .icon-clothes { background: linear-gradient(135deg, #D35400, #A04000); }
    </style>
</head>
<body>
    <!-- Header Mobile -->
    <header class="header-mobile">
        <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="logo-mobile">
            <div class="logo-icon">NC</div>
            <div class="logo-text">Nosso Controle</div>
        </div>
        
        <div class="user-avatar-mobile">
            FO
            <div class="storage-badge" id="storageBadge" title="Dados salvos">
                <i class="fas fa-check"></i>
            </div>
        </div>
    </header>

    <!-- Overlay do Menu -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Menu Lateral Mobile -->
    <nav class="sidebar-mobile" id="sidebarMobile">
        <div class="menu-section">
            <div class="menu-title">Controle Familiar</div>
            <a href="#" class="menu-item active" data-section="dashboard">
                <div class="menu-icon"><i class="fas fa-home"></i></div>
                <div class="menu-text">Dashboard</div>
            </a>
            <a href="#" class="menu-item" data-section="daily">
                <div class="menu-icon"><i class="fas fa-plus-circle"></i></div>
                <div class="menu-text">Lançar Transações</div>
            </a>
            <a href="#" class="menu-item" data-section="people">
                <div class="menu-icon"><i class="fas fa-users"></i></div>
                <div class="menu-text">Gastos por Pessoa</div>
            </a>
            <a href="#" class="menu-item" data-section="categories">
                <div class="menu-icon"><i class="fas fa-tags"></i></div>
                <div class="menu-text">Categorias</div>
            </a>
            <!-- NOVO: Orçamento -->
            <a href="#" class="menu-item" data-section="budget">
                <div class="menu-icon"><i class="fas fa-chart-pie"></i></div>
                <div class="menu-text">Orçamento</div>
            </a>
            <!-- NOVO: Relatórios -->
            <a href="#" class="menu-item" data-section="reports">
                <div class="menu-icon"><i class="fas fa-chart-bar"></i></div>
                <div class="menu-text">Relatórios</div>
            </a>
        </div>
        
        <div class="menu-section">
            <div class="menu-title">Gestão</div>
            <a href="#" class="menu-item" data-section="transactions">
                <div class="menu-icon"><i class="fas fa-exchange-alt"></i></div>
                <div class="menu-text">Transações</div>
            </a>
            <a href="#" class="menu-item" data-section="cards">
                <div class="menu-icon"><i class="fas fa-credit-card"></i></div>
                <div class="menu-text">Cartões</div>
            </a>
            <a href="#" class="menu-item" data-section="goals">
                <div class="menu-icon"><i class="fas fa-bullseye"></i></div>
                <div class="menu-text">Metas</div>
            </a>
            <!-- NOVO: Gerenciar Usuários -->
            <a href="#" class="menu-item" data-section="users">
                <div class="menu-icon"><i class="fas fa-user-plus"></i></div>
                <div class="menu-text">Gerenciar Usuários</div>
            </a>
        </div>
        
        <div class="menu-section">
            <div class="menu-title">Armazenamento</div>
            <a href="#" class="menu-item" data-section="storage">
                <div class="menu-icon"><i class="fas fa-database"></i></div>
                <div class="menu-text">Backup & Exportar</div>
            </a>
            <!-- NOVO: Sincronização -->
            <a href="#" class="menu-item" data-section="sync">
                <div class="menu-icon"><i class="fas fa-sync-alt"></i></div>
                <div class="menu-text">Sincronização</div>
            </a>
        </div>
        
        <div style="padding: 20px 0; text-align: center; color: var(--gray); font-size: 14px;">
            Família Oliveira<br>
            <strong id="currentMonth">Dezembro 2024</strong>
            <div id="storageInfo" style="margin-top: 10px; font-size: 12px;">
                <i class="fas fa-check-circle" style="color: var(--green);"></i>
                Dados salvos localmente
            </div>
        </div>
    </nav>

    <!-- Botão Rápido de Adicionar (NOVO) -->
    <button class="quick-add-btn" id="quickAddBtn">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Modal Rápido (NOVO) -->
    <div class="modal-overlay" id="quickModal">
        <div class="modal quick-modal">
            <div class="modal-header">
                <div class="modal-title">Lançamento Rápido</div>
                <button class="modal-close" id="closeQuickModal">&times;</button>
            </div>
            <div class="modal-content">
                <form id="quick-transaction-form" class="quick-form">
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <input type="text" class="form-input" id="quick-description" placeholder="Ex: Mercado, Salário..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Valor (R$)</label>
                        <input type="number" class="form-input" id="quick-amount" placeholder="0,00" step="0.01" min="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" id="quick-type">
                            <option value="expense">Despesa</option>
                            <option value="income">Receita</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Pessoa</label>
                        <select class="form-select" id="quick-person" required>
                            <!-- Preenchido dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="modal-btn cancel" id="cancelQuickBtn">Cancelar</button>
                        <button type="submit" class="modal-btn save">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Edição (EXISTENTE) -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Editar Transação</div>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-content">
                <form id="edit-transaction-form">
                    <div class="transaction-type-toggle">
                        <button type="button" class="type-btn" data-type="expense">
                            <i class="fas fa-arrow-up"></i> Despesa
                        </button>
                        <button type="button" class="type-btn" data-type="income">
                            <i class="fas fa-arrow-down"></i> Receita
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <input type="text" class="form-input" id="edit-description" placeholder="Ex: Salário, Supermercado, Restaurante..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Valor (R$)</label>
                        <input type="number" class="form-input" id="edit-amount" placeholder="0,00" step="0.01" min="0.01" required>
                    </div>
                    
                    <div class="form-group" id="edit-expense-categories">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="edit-expense-category">
                            <option value="">Selecione...</option>
                            <option value="food">Alimentação</option>
                            <option value="home">Casa</option>
                            <option value="transport">Transporte</option>
                            <option value="education">Educação</option>
                            <option value="health">Saúde</option>
                            <option value="fun">Lazer</option>
                            <option value="clothes">Roupas</option>
                            <option value="other">Outros</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="edit-income-categories" style="display: none;">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="edit-income-category">
                            <option value="">Selecione...</option>
                            <option value="salary">Salário</option>
                            <option value="extra">Renda Extra</option>
                            <option value="investment">Investimentos</option>
                            <option value="refund">Reembolso/Devolução</option>
                            <option value="gift">Presente/Doação</option>
                            <option value="savings">Sobra/Reserva</option>
                            <option value="other_income">Outros</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Responsável</label>
                        <select class="form-select" id="edit-person" required>
                            <!-- Preenchido dinamicamente -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="edit-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Forma de Pagamento</label>
                        <select class="form-select" id="edit-payment" required>
                            <option value="">Selecione...</option>
                            <option value="cash">Dinheiro</option>
                            <option value="debit">Cartão de Débito</option>
                            <option value="credit">Cartão de Crédito</option>
                            <option value="pix">PIX</option>
                            <option value="bank">Transferência Bancária</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="modal-btn delete" id="deleteTransactionBtn">
                    <i class="fas fa-trash"></i> Excluir
                </button>
                <button class="modal-btn cancel" id="cancelEditBtn">Cancelar</button>
                <button class="modal-btn save" id="saveEditBtn">
                    <i class="fas fa-save"></i> Salvar Alterações
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Gerenciar Usuários (NOVO) -->
    <div class="modal-overlay" id="manageUsersModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Gerenciar Usuários</div>
                <button class="modal-close" id="closeManageUsersModal">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <label class="form-label">Nome do Usuário</label>
                    <input type="text" class="form-input" id="new-user-name" placeholder="Digite o nome">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Cor do Usuário</label>
                    <div class="color-picker" id="colorPicker">
                        <!-- Cores serão geradas dinamicamente -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ícone</label>
                    <select class="form-select" id="new-user-icon">
                        <option value="user">👤 Padrão</option>
                        <option value="child">👶 Criança</option>
                        <option value="female">👩 Mulher</option>
                        <option value="male">👨 Homem</option>
                        <option value="family">👪 Família</option>
                        <option value="pet">🐾 Pet</option>
                        <option value="student">🎓 Estudante</option>
                        <option value="worker">👷 Trabalhador</option>
                    </select>
                </div>
                
                <button class="form-submit" id="addUserBtn">
                    <i class="fas fa-user-plus"></i> Adicionar Usuário
                </button>
                
                <div class="users-management" id="currentUsersList" style="margin-top: 20px;">
                    <!-- Usuários serão listados aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <main class="main-content">
        <!-- Dashboard -->
        <div id="dashboard" class="content-section active">
            <h1 class="page-title">Bem-vindo, Família Oliveira!</h1>
            <p class="page-subtitle">Controle financeiro familiar - Dados salvos automaticamente</p>
            
            <!-- Cards de Resumo -->
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Receitas do Mês</div>
                        <div class="card-icon icon-income"><i class="fas fa-money-bill-wave"></i></div>
                    </div>
                    <div class="card-amount income-amount" id="total-income">R$ 0,00</div>
                    <div class="card-footer"><i class="fas fa-database"></i> <span id="saveStatus">Dados salvos</span></div>
                </div>
                
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Despesas do Mês</div>
                        <div class="card-icon icon-expense"><i class="fas fa-shopping-bag"></i></div>
                    </div>
                    <div class="card-amount expense-amount" id="total-expense">R$ 0,00</div>
                    <div class="card-footer"><i class="fas fa-history"></i> Última atualização: <span id="lastUpdate">Agora</span></div>
                </div>
                
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Saldo do Mês</div>
                        <div class="card-icon icon-balance"><i class="fas fa-piggy-bank"></i></div>
                    </div>
                    <div class="card-amount balance-amount" id="total-balance">R$ 0,00</div>
                    <div class="card-footer"><i class="fas fa-shield-alt"></i> <span id="transactionCount">0 transações</span></div>
                </div>
            </div>
            
            <!-- Gastos por Pessoa -->
            <div class="section-title">
                <span><i class="fas fa-users"></i> Gastos por Pessoa</span>
                <button class="add-btn" onclick="showSection('people')">
                    <i class="fas fa-list"></i> Ver Detalhes
                </button>
            </div>
            <div class="people-cards" id="dashboard-people-cards">
                <!-- Preenchido dinamicamente -->
            </div>
            
            <!-- Categorias de Gastos -->
            <h2 class="section-title"><i class="fas fa-tags"></i> Onde está indo seu dinheiro</h2>
            <div class="categories" id="dashboard-categories">
                <!-- Preenchido dinamicamente -->
            </div>

            <!-- Rascunhos Pendentes -->
            <div class="drafts-section" id="drafts-section" style="display: none;">
                <h2 class="section-title"><i class="fas fa-edit"></i> Rascunhos Pendentes</h2>
                <div id="drafts-list">
                    <!-- Rascunhos serão carregados aqui -->
                </div>
            </div>
        </div>
        
        <!-- NOVO: Orçamento Mensal -->
        <div id="budget" class="content-section">
            <h1 class="page-title"><i class="fas fa-chart-pie"></i> Orçamento Mensal</h1>
            <p class="page-subtitle">Controle seus limites e receba alertas quando exceder</p>
            
            <!-- Alertas de Orçamento -->
            <div id="budget-alerts">
                <!-- Alertas serão gerados dinamicamente -->
            </div>
            
            <!-- Configuração de Orçamento -->
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-cog"></i> Configurar Orçamentos</h2>
                <div id="budget-configuration">
                    <!-- Configurações serão geradas dinamicamente -->
                </div>
                <button class="form-submit" onclick="saveBudgets()" style="margin-top: 20px;">
                    <i class="fas fa-save"></i> Salvar Orçamentos
                </button>
            </div>
            
            <!-- Resumo por Categoria -->
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-list-alt"></i> Resumo por Categoria</h2>
                <div id="budget-summary">
                    <!-- Resumo será gerado dinamicamente -->
                </div>
            </div>
        </div>
        
        <!-- NOVO: Relatórios e Gráficos -->
        <div id="reports" class="content-section">
            <h1 class="page-title"><i class="fas fa-chart-bar"></i> Relatórios e Gráficos</h1>
            <p class="page-subtitle">Visualize seus dados de forma interativa</p>
            
            <div class="charts-grid">
                <!-- Gráfico de Pizza - Categorias -->
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Gastos por Categoria</div>
                        <select class="form-select" id="chart-period" style="width: auto; padding: 5px 10px; font-size: 14px;" onchange="updateCharts()">
                            <option value="month">Este Mês</option>
                            <option value="last_month">Mês Anterior</option>
                            <option value="year">Este Ano</option>
                            <option value="all">Todos</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoriesChart"></canvas>
                    </div>
                    <div class="chart-legend" id="categoriesLegend">
                        <!-- Legenda será gerada dinamicamente -->
                    </div>
                </div>
                
                <!-- Gráfico de Barras - Pessoas -->
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Gastos por Pessoa</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="peopleChart"></canvas>
                    </div>
                    <div class="chart-legend" id="peopleLegend">
                        <!-- Legenda será gerada dinamicamente -->
                    </div>
                </div>
            </div>
            
            <!-- Gráfico de Linha - Evolução Mensal -->
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">Evolução Mensal</div>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
            
            <!-- Estatísticas Detalhadas -->
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-calculator"></i> Estatísticas</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Média Mensal</div>
                        <div style="font-size: 20px; font-weight: 700;" id="avg-monthly">R$ 0,00</div>
                    </div>
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Maior Gasto</div>
                        <div style="font-size: 20px; font-weight: 700;" id="max-expense">R$ 0,00</div>
                    </div>
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Categoria Mais Usada</div>
                        <div style="font-size: 16px; font-weight: 600;" id="most-used-category">-</div>
                    </div>
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Dias Restantes</div>
                        <div style="font-size: 20px; font-weight: 700;" id="days-remaining">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- NOVO: Gerenciar Usuários -->
        <div id="users" class="content-section">
            <h1 class="page-title"><i class="fas fa-user-plus"></i> Gerenciar Usuários</h1>
            <p class="page-subtitle">Adicione, edite ou remova usuários do sistema</p>
            
            <div class="users-management" id="usersList">
                <!-- Usuários serão carregados dinamicamente -->
            </div>
            
            <button class="form-submit" onclick="openManageUsersModal()" style="margin-top: 20px;">
                <i class="fas fa-user-plus"></i> Adicionar Novo Usuário
            </button>
            
            <div class="transactions-container" style="margin-top: 30px;">
                <h2 class="section-title"><i class="fas fa-info-circle"></i> Instruções</h2>
                <ul style="color: var(--gray); line-height: 1.6; padding-left: 20px;">
                    <li>Adicione até 10 usuários diferentes</li>
                    <li>Cada usuário terá sua própria cor e ícone</li>
                    <li>Os usuários aparecerão nas transações e relatórios</li>
                    <li>Usuários não podem ser removidos se tiverem transações associadas</li>
                </ul>
            </div>
        </div>
        
        <!-- NOVO: Sincronização -->
        <div id="sync" class="content-section">
            <h1 class="page-title"><i class="fas fa-sync-alt"></i> Sincronização</h1>
            <p class="page-subtitle">Sincronize seus dados entre dispositivos</p>
            
            <div class="sync-section">
                <h3 style="margin-bottom: 15px;"><i class="fas fa-mobile-alt"></i> Sincronização via Código</h3>
                <p style="margin-bottom: 15px; color: var(--gray);">
                    Gere um código de sincronização em um dispositivo e cole no outro para sincronizar os dados.
                </p>
                
                <div class="form-group">
                    <label class="form-label">Código de Sincronização</label>
                    <div class="sync-code" id="syncCode">Gerar código...</div>
                    <button class="copy-btn" onclick="generateSyncCode()">
                        <i class="fas fa-code"></i> Gerar Novo Código
                    </button>
                    <button class="copy-btn" onclick="copySyncCode()">
                        <i class="fas fa-copy"></i> Copiar Código
                    </button>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label class="form-label">Importar de Outro Dispositivo</label>
                    <input type="text" class="form-input" id="importSyncCode" placeholder="Cole o código aqui">
                    <button class="form-submit" onclick="importSyncCode()" style="margin-top: 10px;">
                        <i class="fas fa-download"></i> Sincronizar Dados
                    </button>
                </div>
            </div>
            
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-history"></i> Histórico de Sincronização</h2>
                <div id="sync-history">
                    <!-- Histórico será carregado dinamicamente -->
                </div>
            </div>
        </div>
        
        <!-- Seções existentes MANTIDAS EXATAMENTE COMO ESTAVAM -->
        <!-- Lançamento de Transações -->
        <div id="daily" class="content-section">
            <h1 class="page-title"><i class="fas fa-plus-circle"></i> Lançar Transações</h1>
            <p class="page-subtitle">Adicione receitas e despesas - Dados são salvos automaticamente</p>
            
            <form id="transaction-form" class="entry-form">
                <!-- Toggle entre Despesa e Receita -->
                <div class="transaction-type-toggle">
                    <button type="button" class="type-btn active" data-type="expense">
                        <i class="fas fa-arrow-up"></i> Despesa
                    </button>
                    <button type="button" class="type-btn" data-type="income">
                        <i class="fas fa-arrow-down"></i> Receita
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descrição</label>
                    <input type="text" class="form-input" id="transaction-description" placeholder="Ex: Salário, Supermercado, Restaurante..." required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Valor (R$)</label>
                    <input type="number" class="form-input" id="transaction-amount" placeholder="0,00" step="0.01" min="0.01" required>
                </div>
                
                <!-- Categorias para Despesas -->
                <div class="form-group" id="expense-categories">
                    <label class="form-label">Categoria</label>
                    <select class="form-select" id="expense-category">
                        <option value="">Selecione...</option>
                        <option value="food">Alimentação</option>
                        <option value="home">Casa</option>
                        <option value="transport">Transporte</option>
                        <option value="education">Educação</option>
                        <option value="health">Saúde</option>
                        <option value="fun">Lazer</option>
                        <option value="clothes">Roupas</option>
                        <option value="other">Outros</option>
                    </select>
                </div>
                
                <!-- Categorias para Receitas -->
                <div class="form-group" id="income-categories" style="display: none;">
                    <label class="form-label">Categoria</label>
                    <select class="form-select" id="income-category">
                        <option value="">Selecione...</option>
                        <option value="salary">Salário</option>
                        <option value="extra">Renda Extra</option>
                        <option value="investment">Investimentos</option>
                        <option value="refund">Reembolso/Devolução</option>
                        <option value="gift">Presente/Doação</option>
                        <option value="savings">Sobra/Reserva</option>
                        <option value="other_income">Outros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Responsável</label>
                    <select class="form-select" id="transaction-person" required>
                        <option value="">Selecione...</option>
                        <option value="fabiana">Fabiana</option>
                        <option value="marcos">Marcos</option>
                        <option value="family">Família</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="transaction-date" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Forma de Pagamento</label>
                    <select class="form-select" id="transaction-payment" required>
                        <option value="">Selecione...</option>
                        <option value="cash">Dinheiro</option>
                        <option value="debit">Cartão de Débito</option>
                        <option value="credit">Cartão de Crédito</option>
                        <option value="pix">PIX</option>
                        <option value="bank">Transferência Bancária</option>
                    </select>
                </div>
                
                <!-- Botões de Ação -->
                <div class="form-actions">
                    <button type="button" class="save-btn" id="save-draft-btn">
                        <i class="fas fa-save"></i> SALVAR RASCUNHO
                    </button>
                    <button type="submit" class="form-submit" id="submit-btn">
                        <i class="fas fa-check"></i> LANÇAR TRANSAÇÃO
                    </button>
                </div>
            </form>
            
            <!-- Rascunhos Pendentes -->
            <div class="drafts-section">
                <h2 class="section-title"><i class="fas fa-edit"></i> Rascunhos Pendentes</h2>
                <div id="drafts-list-daily">
                    <!-- Rascunhos serão carregados aqui -->
                </div>
            </div>
            
            <!-- Transações Recentes -->
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-history"></i> Últimas Transações</h2>
                <div id="recent-transactions">
                    <!-- Transações serão carregadas aqui -->
                </div>
            </div>
        </div>
        
        <!-- Seção de Armazenamento/Backup -->
        <div id="storage" class="content-section">
            <h1 class="page-title"><i class="fas fa-database"></i> Backup & Exportar Dados</h1>
            <p class="page-subtitle">Gerencie seus dados e faça backups de segurança</p>
            
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Backup Local</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, #3498DB, #5DADE2);">
                            <i class="fas fa-save"></i>
                        </div>
                    </div>
                    <div class="card-amount" id="backup-count">0 transações</div>
                    <div class="card-footer"><i class="fas fa-calendar"></i> Último backup: <span id="last-backup">Nunca</span></div>
                    <div class="form-actions" style="margin-top: 15px;">
                        <button class="save-btn" onclick="exportToJSON()">
                            <i class="fas fa-download"></i> Exportar JSON
                        </button>
                        <button class="form-submit" onclick="importFromJSON()">
                            <i class="fas fa-upload"></i> Importar JSON
                        </button>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Exportar para Excel</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, #2ECC71, #27AE60);">
                            <i class="fas fa-file-excel"></i>
                        </div>
                    </div>
                    <div class="card-amount">.XLSX</div>
                    <div class="card-footer"><i class="fas fa-table"></i> Compatível com Excel e Google Sheets</div>
                    <button class="form-submit" style="margin-top: 15px;" onclick="exportToExcel()">
                        <i class="fas fa-download"></i> Baixar Excel
                    </button>
                </div>
                
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Limpar Dados</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, #E74C3C, #C0392B);">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                    <div class="card-amount" style="color: #E74C3C;">Cuidado!</div>
                    <div class="card-footer"><i class="fas fa-exclamation-triangle"></i> Esta ação não pode ser desfeita</div>
                    <div class="form-actions" style="margin-top: 15px;">
                        <button class="save-btn" onclick="clearData()" style="background: linear-gradient(135deg, #E74C3C, #C0392B);">
                            <i class="fas fa-trash-alt"></i> Limpar Tudo
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Estatísticas -->
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-chart-bar"></i> Estatísticas</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Transações</div>
                        <div style="font-size: 20px; font-weight: 700;" id="stats-transactions">0</div>
                    </div>
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Rascunhos</div>
                        <div style="font-size: 20px; font-weight: 700;" id="stats-drafts">0</div>
                    </div>
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Espaço Usado</div>
                        <div style="font-size: 20px; font-weight: 700;" id="stats-space">0 KB</div>
                    </div>
                    <div style="background: var(--gray-light); padding: 15px; border-radius: 10px;">
                        <div style="font-size: 12px; color: var(--gray);">Último Save</div>
                        <div style="font-size: 16px; font-weight: 600;" id="stats-lastsave">Agora</div>
                    </div>
                </div>
            </div>
            
            <!-- Backup Automático -->
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-robot"></i> Backup Automático</h2>
                <p style="margin-bottom: 15px; color: var(--gray);">Seus dados são salvos automaticamente no navegador a cada alteração.</p>
                
                <div style="background: rgba(46, 204, 113, 0.1); padding: 15px; border-radius: 10px; border-left: 4px solid var(--green);">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i class="fas fa-check-circle" style="color: var(--green);"></i>
                        <span style="font-weight: 600;">LocalStorage Ativo</span>
                    </div>
                    <p style="font-size: 14px; color: var(--dark);">
                        Seus dados estão seguros neste navegador. Para backup em outro dispositivo, exporte para JSON.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Gastos por Pessoa (Detalhado) -->
        <div id="people" class="content-section">
            <h1 class="page-title"><i class="fas fa-users"></i> Gastos por Pessoa</h1>
            <p class="page-subtitle">Detalhamento completo dos gastos de cada membro</p>
            
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Fabiana Oliveira</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--purple), #8E44AD);">
                            <i class="fas fa-female"></i>
                        </div>
                    </div>
                    <div class="card-amount" style="color: var(--purple);" id="detail-fabiana">R$ 0,00</div>
                    <div class="card-footer"><i class="fas fa-tags"></i> Comece a lançar transações</div>
                </div>
                
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Marcos Oliveira</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--blue), #2980B9);">
                            <i class="fas fa-male"></i>
                        </div>
                    </div>
                    <div class="card-amount" style="color: var(--blue);" id="detail-marcos">R$ 0,00</div>
                    <div class="card-footer"><i class="fas fa-tags"></i> Comece a lançar transações</div>
                </div>
                
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Despesas Familiares</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--green), #27AE60);">
                            <i class="fas fa-home"></i>
                        </div>
                    </div>
                    <div class="card-amount" style="color: var(--green);" id="detail-family">R$ 0,00</div>
                    <div class="card-footer"><i class="fas fa-tags"></i> Comece a lançar transações</div>
                </div>
            </div>
            
            <!-- Detalhamento em Tabela -->
            <div class="transactions-container">
                <h2 class="section-title"><i class="fas fa-list"></i> Detalhamento por Pessoa</h2>
                <div style="overflow-x: auto;">
                    <table class="details-table">
                        <thead>
                            <tr>
                                <th>Pessoa</th>
                                <th>Tipo</th>
                                <th>Descrição</th>
                                <th>Valor</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="people-details">
                            <!-- Dados serão carregados aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Categorias -->
        <div id="categories" class="content-section">
            <h1 class="page-title"><i class="fas fa-tags"></i> Categorias de Gastos</h1>
            <p class="page-subtitle">Controle seus limites por categoria</p>
            
            <div class="categories" id="categories-container">
                <!-- Categorias serão carregadas dinamicamente -->
            </div>
        </div>
        
        <!-- Transações -->
        <div id="transactions" class="content-section">
            <h1 class="page-title"><i class="fas fa-exchange-alt"></i> Todas as Transações</h1>
            <p class="page-subtitle">Histórico completo de todas as transações</p>
            
            <div class="transactions-container">
                <div id="all-transactions">
                    <!-- Transações serão carregadas aqui -->
                </div>
            </div>
        </div>
        
        <!-- Cartões -->
        <div id="cards" class="content-section">
            <h1 class="page-title"><i class="fas fa-credit-card"></i> Cartões de Crédito</h1>
            <p class="page-subtitle">Gerencie seus cartões e faturas</p>
            
            <div class="summary-cards" id="cards-container">
                <!-- Cartões serão carregados dinamicamente -->
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Adicionar Cartão</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--secondary), #8B7AFF);">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    <div class="card-amount" style="color: var(--secondary);">Clique para cadastrar</div>
                    <div class="card-footer"><i class="fas fa-credit-card"></i> Cadastre seu primeiro cartão</div>
                    <button class="form-submit" style="margin-top: 15px;" onclick="addNewCard()">
                        <i class="fas fa-plus"></i> Novo Cartão
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Metas -->
        <div id="goals" class="content-section">
            <h1 class="page-title"><i class="fas fa-bullseye"></i> Metas Financeiras</h1>
            <p class="page-subtitle">Acompanhe suas metas de economia</p>
            
            <div class="summary-card">
                <div class="card-header">
                    <div class="card-title">Economia Mensal</div>
                    <div class="card-icon" style="background: linear-gradient(135deg, var(--green), #27AE60);">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                </div>
                <div class="card-amount" style="color: var(--green);" id="goal-saving">R$ 0,00</div>
                <div class="card-footer"><i class="fas fa-target"></i> Meta: R$ 1.200,00/mês</div>
            </div>
        </div>
    </main>

    <!-- Notificação -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="notification-content">
            <h4 id="notificationTitle">Notificação</h4>
            <p id="notificationMessage">Mensagem de notificação</p>
        </div>
    </div>

    <!-- Input oculto para importação -->
    <input type="file" id="fileImport" accept=".json" style="display: none;">

    <script>
        // ===================== SISTEMA DE ARMAZENAMENTO SIMPLES =====================
        const AppData = {
            transactions: [],
            drafts: [],
            cards: [],
            budgets: {}, // NOVO: orçamentos mensais
            users: {},   // NOVO: usuários personalizáveis
            syncHistory: [], // NOVO: histórico de sincronização
            
            // Categorias
            categories: {
                food: { name: "Alimentação", limit: 1500, color: "#FF7A5A", icon: "fa-utensils" },
                home: { name: "Casa", limit: 1200, color: "#6A4CFF", icon: "fa-home" },
                transport: { name: "Transporte", limit: 600, color: "#3498DB", icon: "fa-car" },
                education: { name: "Educação", limit: 800, color: "#9B59B6", icon: "fa-graduation-cap" },
                health: { name: "Saúde", limit: 400, color: "#E74C3C", icon: "fa-heartbeat" },
                fun: { name: "Lazer", limit: 300, color: "#F1C40F", icon: "fa-gamepad" },
                clothes: { name: "Roupas", limit: 500, color: "#1ABC9C", icon: "fa-tshirt" },
                other: { name: "Outros", limit: 200, color: "#95A5A6", icon: "fa-tag" }
            },
            
            incomeCategories: {
                salary: { name: "Salário", color: "#2ECC71", icon: "fa-money-check" },
                extra: { name: "Renda Extra", color: "#3498DB", icon: "fa-coins" },
                investment: { name: "Investimentos", color: "#9B59B6", icon: "fa-chart-line" },
                refund: { name: "Reembolso", color: "#F1C40F", icon: "fa-undo" },
                gift: { name: "Presente", color: "#E74C3C", icon: "fa-gift" },
                savings: { name: "Reserva", color: "#1ABC9C", icon: "fa-piggy-bank" },
                other_income: { name: "Outros", color: "#95A5A6", icon: "fa-wallet" }
            },
            
            // Pessoas (usuários) - agora dinâmico
            people: {
                fabiana: { name: "Fabiana", color: "#9B59B6", icon: "female" },
                marcos: { name: "Marcos", color: "#3498DB", icon: "male" },
                family: { name: "Família", color: "#2ECC71", icon: "home" }
            },
            
            stats: {
                lastSave: null,
                saveCount: 0
            },
            
            // Variáveis para edição
            editingTransaction: null,
            
            // Variáveis para gráficos
            charts: {
                categories: null,
                people: null,
                monthly: null
            }
        };

        // ===================== FUNÇÕES DE NOTIFICAÇÃO =====================
        function showNotification(title, message, type = 'info') {
            const notification = document.getElementById('notification');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            const icon = notification.querySelector('.notification-icon i');
            
            notification.className = `notification ${type}`;
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-times-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            icon.className = `fas ${icons[type] || 'fa-info-circle'}`;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
            
            console.log(`Notificação: ${title} - ${message}`);
        }

        // ===================== LOCALSTORAGE =====================
        function saveToLocalStorage() {
            try {
                const dataToSave = {
                    transactions: AppData.transactions,
                    drafts: AppData.drafts,
                    cards: AppData.cards,
                    budgets: AppData.budgets, // NOVO
                    users: AppData.users,     // NOVO
                    people: AppData.people,   // NOVO
                    syncHistory: AppData.syncHistory, // NOVO
                    stats: AppData.stats,
                    timestamp: new Date().toISOString(),
                    version: '4.0'
                };
                
                localStorage.setItem('nossoControle', JSON.stringify(dataToSave));
                
                // Feedback visual
                const badge = document.getElementById('storageBadge');
                badge.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i>';
                badge.className = 'storage-badge storage-saving';
                
                // Atualizar estatísticas
                AppData.stats.lastSave = new Date().toISOString();
                AppData.stats.saveCount = (AppData.stats.saveCount || 0) + 1;
                
                setTimeout(() => {
                    badge.innerHTML = '<i class="fas fa-check"></i>';
                    badge.className = 'storage-badge';
                }, 500);
                
                updateSaveStatus();
                console.log('Dados salvos com sucesso!');
                return true;
            } catch (e) {
                console.error('Erro ao salvar:', e);
                showNotification('Erro', 'Não foi possível salvar os dados', 'error');
                
                const badge = document.getElementById('storageBadge');
                badge.innerHTML = '<i class="fas fa-exclamation"></i>';
                badge.className = 'storage-badge storage-error';
                
                return false;
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('nossoControle');
                if (saved) {
                    const data = JSON.parse(saved);
                    
                    AppData.transactions = data.transactions || [];
                    AppData.drafts = data.drafts || [];
                    AppData.cards = data.cards || [];
                    AppData.budgets = data.budgets || {}; // NOVO
                    AppData.users = data.users || {};     // NOVO
                    AppData.people = data.people || AppData.people; // Mantém padrão se não existir
                    AppData.syncHistory = data.syncHistory || []; // NOVO
                    AppData.stats = data.stats || { lastSave: null, saveCount: 0 };
                    
                    console.log('Dados carregados:', AppData.transactions.length, 'transações');
                    
                    // Atualizar data atual no cabeçalho
                    const now = new Date();
                    const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                                       'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                    document.getElementById('currentMonth').textContent = 
                        `${monthNames[now.getMonth()]} ${now.getFullYear()}`;
                    
                    return true;
                }
            } catch (e) {
                console.error('Erro ao carregar:', e);
                showNotification('Erro', 'Erro ao carregar dados salvos', 'error');
            }
            return false;
        }

        function updateSaveStatus() {
            const lastSave = AppData.stats.lastSave;
            const saveCount = AppData.stats.saveCount || 0;
            
            document.getElementById('saveStatus').textContent = 
                saveCount > 0 ? `${saveCount} salvamentos` : 'Dados salvos';
            
            document.getElementById('lastUpdate').textContent = lastSave ? 
                new Date(lastSave).toLocaleTimeString('pt-BR') : 'Agora';
            
            document.getElementById('transactionCount').textContent = 
                `${AppData.transactions.length} transações`;
            
            document.getElementById('stats-transactions').textContent = AppData.transactions.length;
            document.getElementById('stats-drafts').textContent = AppData.drafts.length;
            document.getElementById('stats-space').textContent = 
                `${(JSON.stringify(AppData).length / 1024).toFixed(1)} KB`;
            document.getElementById('stats-lastsave').textContent = lastSave ? 
                new Date(lastSave).toLocaleTimeString('pt-BR') : 'Agora';
            
            document.getElementById('backup-count').textContent = 
                `${AppData.transactions.length} transações`;
            document.getElementById('last-backup').textContent = lastSave ? 
                new Date(lastSave).toLocaleDateString('pt-BR') : 'Nunca';
        }

        // ===================== FUNÇÕES DO SISTEMA ORIGINAL =====================
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function getCategoryName(category, type = 'expense') {
            if (type === 'income') {
                return AppData.incomeCategories[category]?.name || category;
            }
            return AppData.categories[category]?.name || category;
        }

        function getPersonName(person) {
            return AppData.people[person]?.name || person;
        }

        function getPaymentName(payment) {
            const payments = {
                cash: "Dinheiro",
                debit: "Cartão de Débito",
                credit: "Cartão de Crédito",
                pix: "PIX",
                bank: "Transferência Bancária"
            };
            return payments[payment] || payment;
        }

        function updateDashboard() {
            // Calcular totais
            const incomes = AppData.transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const expenses = AppData.transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const balance = incomes - expenses;
            
            // Atualizar cards
            document.getElementById('total-income').textContent = formatCurrency(incomes);
            document.getElementById('total-expense').textContent = formatCurrency(expenses);
            document.getElementById('total-balance').textContent = formatCurrency(Math.abs(balance));
            
            if (balance >= 0) {
                document.getElementById('total-balance').className = 'card-amount income-amount';
            } else {
                document.getElementById('total-balance').className = 'card-amount negative';
                document.getElementById('total-balance').style.color = '#E74C3C';
            }
            
            // Gastos por pessoa
            const expensesByPerson = {};
            AppData.transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expensesByPerson[t.person] = (expensesByPerson[t.person] || 0) + t.amount;
                });
            
            document.getElementById('expense-fabiana').textContent = formatCurrency(expensesByPerson.fabiana || 0);
            document.getElementById('expense-marcos').textContent = formatCurrency(expensesByPerson.marcos || 0);
            document.getElementById('expense-family').textContent = formatCurrency(expensesByPerson.family || 0);
            
            // Detalhamento por pessoa
            document.getElementById('detail-fabiana').textContent = formatCurrency(expensesByPerson.fabiana || 0);
            document.getElementById('detail-marcos').textContent = formatCurrency(expensesByPerson.marcos || 0);
            document.getElementById('detail-family').textContent = formatCurrency(expensesByPerson.family || 0);
            
            // Gastos por categoria
            const expensesByCategory = {};
            AppData.transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
                });
            
            document.getElementById('category-food').textContent = formatCurrency(expensesByCategory.food || 0);
            document.getElementById('category-home').textContent = formatCurrency(expensesByCategory.home || 0);
            document.getElementById('category-transport').textContent = formatCurrency(expensesByCategory.transport || 0);
            
            // Atualizar barras de progresso
            updateProgressBars(expensesByCategory);
            
            // Metas
            document.getElementById('goal-saving').textContent = formatCurrency(balance);
            
            updateSaveStatus();
        }

        function updateProgressBars(expensesByCategory) {
            // Alimentação
            const foodSpent = expensesByCategory.food || 0;
            const foodPercentage = Math.min(Math.round((foodSpent / AppData.categories.food.limit) * 100), 100);
            if (document.getElementById('progress-food')) {
                document.getElementById('progress-food').style.width = foodPercentage + '%';
            }
            
            // Casa
            const homeSpent = expensesByCategory.home || 0;
            const homePercentage = Math.min(Math.round((homeSpent / AppData.categories.home.limit) * 100), 100);
            if (document.getElementById('progress-home')) {
                document.getElementById('progress-home').style.width = homePercentage + '%';
            }
            
            // Transporte
            const transportSpent = expensesByCategory.transport || 0;
            const transportPercentage = Math.min(Math.round((transportSpent / AppData.categories.transport.limit) * 100), 100);
            if (document.getElementById('progress-transport')) {
                document.getElementById('progress-transport').style.width = transportPercentage + '%';
            }
        }

        // ===================== SISTEMA DE EDIÇÃO/EXCLUSÃO =====================
        function renderTransactions(containerId, transactions) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-receipt fa-2x" style="margin-bottom: 15px;"></i>
                        <p>Nenhuma transação registrada</p>
                        <p style="font-size: 13px; margin-top: 10px;">Comece lançando sua primeira transação</p>
                    </div>
                `;
                return;
            }
            
            const sortedTransactions = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sortedTransactions.map(transaction => {
                const person = AppData.people[transaction.person];
                const personColor = person?.color || '#95A5A6';
                
                return `
                    <div class="transaction-item" id="transaction-${transaction.id}">
                        <div class="transaction-info">
                            <div class="transaction-icon" style="background: linear-gradient(135deg, ${transaction.type === 'income' ? '#2ECC71' : '#FF7A5A'}, ${transaction.type === 'income' ? '#27AE60' : '#E56A4A'});">
                                <i class="fas fa-${transaction.type === 'income' ? 'arrow-down' : 'arrow-up'}"></i>
                            </div>
                            <div class="transaction-details">
                                <h4>${transaction.description}</h4>
                                <p>${transaction.date} • ${getPersonName(transaction.person)}</p>
                                <small style="color: ${transaction.type === 'income' ? '#2ECC71' : '#FF7A5A'};">${getCategoryName(transaction.category, transaction.type)}</small>
                                <div class="transaction-actions">
                                    <button class="action-btn edit-btn" onclick="editTransaction(${transaction.id})">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="action-btn delete-btn" onclick="deleteTransaction(${transaction.id})">
                                        <i class="fas fa-trash"></i> Excluir
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="transaction-amount ${transaction.type === 'income' ? 'amount-income' : 'amount-expense'}">
                            ${transaction.type === 'income' ? '+' : '-'} ${formatCurrency(transaction.amount)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPeopleDetails() {
            const container = document.getElementById('people-details');
            if (!container) return;
            
            if (AppData.transactions.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-receipt fa-2x" style="margin-bottom: 15px;"></i>
                            <p>Nenhuma transação registrada</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const sortedTransactions = [...AppData.transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sortedTransactions.map(transaction => {
                const person = AppData.people[transaction.person];
                const personColor = person?.color || '#95A5A6';
                
                return `
                    <tr>
                        <td><strong style="color: ${personColor}">${getPersonName(transaction.person)}</strong></td>
                        <td>
                            <span style="background: ${transaction.type === 'income' ? 'rgba(46, 204, 113, 0.1)' : 'rgba(255, 122, 90, 0.1)'}; 
                                        color: ${transaction.type === 'income' ? 'var(--green)' : 'var(--primary)'}; 
                                        padding: 4px 10px; border-radius: 20px; font-size: 12px;">
                                ${transaction.type === 'income' ? 'Receita' : 'Despesa'}
                            </span>
                        </td>
                        <td>${transaction.description}</td>
                        <td style="color: ${transaction.type === 'income' ? 'var(--green)' : 'var(--primary)'}; font-weight: 600;">
                            ${transaction.type === 'income' ? '+' : '-'} ${formatCurrency(transaction.amount)}
                        </td>
                        <td>${transaction.date}</td>
                        <td><span class="status-badge status-paid">${transaction.type === 'income' ? 'Recebido' : 'Pago'}</span></td>
                        <td>
                            <button class="action-btn edit-btn" style="padding: 4px 8px; font-size: 12px;" onclick="editTransaction(${transaction.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete-btn" style="padding: 4px 8px; font-size: 12px;" onclick="deleteTransaction(${transaction.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function editTransaction(transactionId) {
            const transaction = AppData.transactions.find(t => t.id === transactionId);
            if (!transaction) {
                showNotification('Erro', 'Transação não encontrada', 'error');
                return;
            }
            
            AppData.editingTransaction = transaction;
            
            // Preencher formulário
            document.getElementById('edit-description').value = transaction.description;
            document.getElementById('edit-amount').value = transaction.amount;
            document.getElementById('edit-person').value = transaction.person;
            document.getElementById('edit-date').value = transaction.date;
            document.getElementById('edit-payment').value = transaction.payment;
            
            // Configurar tipo
            const typeBtns = document.querySelectorAll('#edit-transaction-form .type-btn');
            typeBtns.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-type') === transaction.type) {
                    btn.classList.add('active');
                }
            });
            
            // Configurar categorias
            if (transaction.type === 'expense') {
                document.getElementById('edit-expense-categories').style.display = 'block';
                document.getElementById('edit-income-categories').style.display = 'none';
                document.getElementById('edit-expense-category').value = transaction.category;
            } else {
                document.getElementById('edit-expense-categories').style.display = 'none';
                document.getElementById('edit-income-categories').style.display = 'block';
                document.getElementById('edit-income-category').value = transaction.category;
            }
            
            // Mostrar modal
            document.getElementById('editModal').classList.add('active');
        }

        function saveEditedTransaction() {
            if (!AppData.editingTransaction) return;
            
            const type = document.querySelector('#edit-transaction-form .type-btn.active').getAttribute('data-type');
            const description = document.getElementById('edit-description').value.trim();
            const amount = parseFloat(document.getElementById('edit-amount').value);
            const category = type === 'expense' 
                ? document.getElementById('edit-expense-category').value
                : document.getElementById('edit-income-category').value;
            const person = document.getElementById('edit-person').value;
            const date = document.getElementById('edit-date').value;
            const payment = document.getElementById('edit-payment').value;
            
            if (!description || !amount || !category || !person || !date || !payment) {
                showNotification('Atenção', 'Preencha todos os campos!', 'error');
                return;
            }
            
            // Atualizar transação
            const index = AppData.transactions.findIndex(t => t.id === AppData.editingTransaction.id);
            if (index !== -1) {
                AppData.transactions[index] = {
                    ...AppData.transactions[index],
                    description,
                    amount,
                    category,
                    person,
                    date,
                    payment,
                    type: type
                };
                
                saveToLocalStorage();
                updateDashboard();
                renderTransactions('recent-transactions', AppData.transactions.slice(0, 10));
                renderPeopleDetails();
                renderCategories();
                renderTransactions('all-transactions', AppData.transactions);
                
                showNotification('Transação Atualizada', 'Transação editada com sucesso!', 'success');
            }
            
            closeEditModal();
        }

        function deleteTransaction(transactionId) {
            if (!confirm('Tem certeza que deseja excluir esta transação?\nEsta ação não pode ser desfeita.')) {
                return;
            }
            
            const index = AppData.transactions.findIndex(t => t.id === transactionId);
            if (index !== -1) {
                AppData.transactions.splice(index, 1);
                
                saveToLocalStorage();
                updateDashboard();
                renderTransactions('recent-transactions', AppData.transactions.slice(0, 10));
                renderPeopleDetails();
                renderCategories();
                renderTransactions('all-transactions', AppData.transactions);
                
                showNotification('Transação Excluída', 'Transação excluída com sucesso!', 'success');
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            AppData.editingTransaction = null;
            document.getElementById('edit-transaction-form').reset();
        }

        // ===================== SISTEMA DE CARTÕES DINÂMICO =====================
        function renderCards() {
            const container = document.getElementById('cards-container');
            if (!container) return;
            
            if (AppData.cards.length === 0) {
                container.innerHTML = `
                    <div class="summary-card">
                        <div class="card-header">
                            <div class="card-title">Adicionar Cartão</div>
                            <div class="card-icon" style="background: linear-gradient(135deg, var(--secondary), #8B7AFF);">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                        <div class="card-amount" style="color: var(--secondary);">Clique para cadastrar</div>
                        <div class="card-footer"><i class="fas fa-credit-card"></i> Cadastre seu primeiro cartão</div>
                        <button class="form-submit" style="margin-top: 15px;" onclick="addNewCard()">
                            <i class="fas fa-plus"></i> Novo Cartão
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = AppData.cards.map(card => `
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">${card.name}</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, ${card.color}, ${card.color}99);">
                            <i class="fab fa-cc-${card.brand === 'visa' ? 'visa' : 'mastercard'}"></i>
                        </div>
                    </div>
                    <div class="card-amount">${formatCurrency(card.limit)}</div>
                    <div class="card-footer">
                        <i class="fas fa-calendar"></i> Fatura: ${card.invoiceDay} • Venc: ${card.dueDay}
                    </div>
                    <div class="transaction-actions" style="margin-top: 15px;">
                        <button class="action-btn edit-btn" onclick="editCard(${card.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteCard(${card.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Adicionar card para novo cartão
            container.innerHTML += `
                <div class="summary-card">
                    <div class="card-header">
                        <div class="card-title">Adicionar Cartão</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, var(--secondary), #8B7AFF);">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    <div class="card-amount" style="color: var(--secondary);">Clique para cadastrar</div>
                    <div class="card-footer"><i class="fas fa-credit-card"></i> Adicionar novo cartão</div>
                    <button class="form-submit" style="margin-top: 15px;" onclick="addNewCard()">
                        <i class="fas fa-plus"></i> Novo Cartão
                    </button>
                </div>
            `;
        }

        function addNewCard() {
            const name = prompt('Nome do cartão (ex: Nubank, Itaú):');
            if (!name) return;
            
            const limit = parseFloat(prompt('Limite do cartão (R$):'));
            if (!limit || limit <= 0) {
                showNotification('Erro', 'Limite inválido', 'error');
                return;
            }
            
            const invoiceDay = parseInt(prompt('Dia da fatura (1-31):'));
            if (!invoiceDay || invoiceDay < 1 || invoiceDay > 31) {
                showNotification('Erro', 'Dia da fatura inválido', 'error');
                return;
            }
            
            const dueDay = parseInt(prompt('Dia do vencimento (1-31):'));
            if (!dueDay || dueDay < 1 || dueDay > 31) {
                showNotification('Erro', 'Dia do vencimento inválido', 'error');
                return;
            }
            
            const brand = confirm('É cartão Visa? (OK para Visa, Cancelar para Mastercard)') ? 'visa' : 'mastercard';
            const colors = ['#8A2387', '#E94057', '#F27121', '#EC6F66', '#F3A183', '#6A4CFF', '#3498DB'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            const newCard = {
                id: Date.now(),
                name,
                limit,
                invoiceDay,
                dueDay,
                brand,
                color
            };
            
            AppData.cards.push(newCard);
            saveToLocalStorage();
            renderCards();
            
            showNotification('Cartão Adicionado', `Cartão ${name} cadastrado com sucesso!`, 'success');
        }

        function editCard(cardId) {
            const card = AppData.cards.find(c => c.id === cardId);
            if (!card) return;
            
            const name = prompt('Nome do cartão:', card.name);
            if (!name) return;
            
            const limit = parseFloat(prompt('Limite do cartão (R$):', card.limit));
            if (!limit || limit <= 0) {
                showNotification('Erro', 'Limite inválido', 'error');
                return;
            }
            
            const invoiceDay = parseInt(prompt('Dia da fatura (1-31):', card.invoiceDay));
            if (!invoiceDay || invoiceDay < 1 || invoiceDay > 31) {
                showNotification('Erro', 'Dia da fatura inválido', 'error');
                return;
            }
            
            const dueDay = parseInt(prompt('Dia do vencimento (1-31):', card.dueDay));
            if (!dueDay || dueDay < 1 || dueDay > 31) {
                showNotification('Erro', 'Dia do vencimento inválido', 'error');
                return;
            }
            
            const index = AppData.cards.findIndex(c => c.id === cardId);
            if (index !== -1) {
                AppData.cards[index] = {
                    ...AppData.cards[index],
                    name,
                    limit,
                    invoiceDay,
                    dueDay
                };
                
                saveToLocalStorage();
                renderCards();
                showNotification('Cartão Atualizado', `Cartão ${name} atualizado com sucesso!`, 'success');
            }
        }

        function deleteCard(cardId) {
            if (!confirm('Tem certeza que deseja excluir este cartão?')) return;
            
            const index = AppData.cards.findIndex(c => c.id === cardId);
            if (index !== -1) {
                const cardName = AppData.cards[index].name;
                AppData.cards.splice(index, 1);
                
                saveToLocalStorage();
                renderCards();
                showNotification('Cartão Excluído', `Cartão ${cardName} excluído com sucesso!`, 'success');
            }
        }

        // ===================== NOVO: ORÇAMENTO MENSAL AVANÇADO =====================
        function setupBudgets() {
            // Inicializar orçamentos se não existirem
            if (Object.keys(AppData.budgets).length === 0) {
                Object.keys(AppData.categories).forEach(category => {
                    AppData.budgets[category] = AppData.categories[category].limit;
                });
            }
            
            // Renderizar configuração
            renderBudgetConfiguration();
            
            // Verificar alertas
            checkBudgetAlerts();
        }

        function renderBudgetConfiguration() {
            const container = document.getElementById('budget-configuration');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.entries(AppData.categories).forEach(([key, category]) => {
                const budget = AppData.budgets[key] || category.limit;
                
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label class="form-label">${category.name}</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="range" class="form-input" id="budget-${key}" 
                               min="0" max="5000" step="50" value="${budget}"
                               style="flex: 1; padding: 0;">
                        <input type="number" class="form-input" id="budget-value-${key}" 
                               value="${budget}" style="width: 100px;"
                               onchange="document.getElementById('budget-${key}').value = this.value; calculateTotalBudget()">
                        <span style="color: var(--gray); font-size: 14px;">R$</span>
                    </div>
                    <div style="font-size: 12px; color: var(--gray); margin-top: 5px;">
                        Limite padrão: R$ ${category.limit.toFixed(2)}
                    </div>
                `;
                container.appendChild(div);
                
                // Sincronizar slider com input numérico
                const slider = document.getElementById(`budget-${key}`);
                const input = document.getElementById(`budget-value-${key}`);
                
                slider.addEventListener('input', function() {
                    input.value = this.value;
                    calculateTotalBudget();
                });
                
                input.addEventListener('input', function() {
                    slider.value = this.value;
                    calculateTotalBudget();
                });
            });
            
            calculateTotalBudget();
        }

        function calculateTotalBudget() {
            let total = 0;
            Object.keys(AppData.categories).forEach(key => {
                const input = document.getElementById(`budget-value-${key}`);
                if (input) {
                    total += parseFloat(input.value) || 0;
                }
            });
            
            const totalElement = document.getElementById('total-budget');
            if (totalElement) {
                totalElement.textContent = `Total: R$ ${total.toFixed(2)}`;
            }
        }

        function saveBudgets() {
            Object.keys(AppData.categories).forEach(key => {
                const input = document.getElementById(`budget-value-${key}`);
                if (input) {
                    AppData.budgets[key] = parseFloat(input.value) || AppData.categories[key].limit;
                }
            });
            
            saveToLocalStorage();
            checkBudgetAlerts();
            renderBudgetSummary();
            
            showNotification('Orçamentos Salvos', 'Seus orçamentos foram atualizados!', 'success');
        }

        function checkBudgetAlerts() {
            const container = document.getElementById('budget-alerts');
            if (!container) return;
            
            container.innerHTML = '';
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Calcular gastos do mês atual por categoria
            const monthlyExpenses = {};
            AppData.transactions.forEach(transaction => {
                if (transaction.type !== 'expense') return;
                
                const transDate = new Date(transaction.date);
                if (transDate.getMonth() === currentMonth && transDate.getFullYear() === currentYear) {
                    monthlyExpenses[transaction.category] = (monthlyExpenses[transaction.category] || 0) + transaction.amount;
                }
            });
            
            let hasAlerts = false;
            
            Object.entries(AppData.budgets).forEach(([category, budget]) => {
                const spent = monthlyExpenses[category] || 0;
                const percentage = (spent / budget) * 100;
                
                if (percentage >= 80) {
                    hasAlerts = true;
                    const categoryName = AppData.categories[category]?.name || category;
                    
                    const alert = document.createElement('div');
                    alert.className = percentage >= 100 ? 'budget-warning critical' : 'budget-warning';
                    
                    alert.innerHTML = `
                        <i class="fas fa-exclamation-triangle" style="color: ${percentage >= 100 ? '#E74C3C' : 'var(--yellow)'}"></i>
                        <div style="flex: 1;">
                            <strong>${categoryName}</strong>
                            <div style="font-size: 13px; margin-top: 5px;">
                                Você gastou R$ ${spent.toFixed(2)} de R$ ${budget.toFixed(2)} (${percentage.toFixed(0)}%)
                            </div>
                            <div class="budget-progress">
                                <div class="percentage ${percentage >= 100 ? 'high' : percentage >= 80 ? 'medium' : 'low'}">
                                    ${percentage.toFixed(0)}% utilizado
                                </div>
                                <div>Restam R$ ${Math.max(0, budget - spent).toFixed(2)}</div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(alert);
                }
            });
            
            if (!hasAlerts) {
                container.innerHTML = `
                    <div class="budget-warning good">
                        <i class="fas fa-check-circle" style="color: var(--green);"></i>
                        <div style="flex: 1;">
                            <strong>Tudo sob controle!</strong>
                            <div style="font-size: 13px; margin-top: 5px;">
                                Nenhum orçamento excedido este mês.
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function renderBudgetSummary() {
            const container = document.getElementById('budget-summary');
            if (!container) return;
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Calcular gastos do mês atual por categoria
            const monthlyExpenses = {};
            AppData.transactions.forEach(transaction => {
                if (transaction.type !== 'expense') return;
                
                const transDate = new Date(transaction.date);
                if (transDate.getMonth() === currentMonth && transDate.getFullYear() === currentYear) {
                    monthlyExpenses[transaction.category] = (monthlyExpenses[transaction.category] || 0) + transaction.amount;
                }
            });
            
            let html = '';
            Object.entries(AppData.budgets).forEach(([category, budget]) => {
                const spent = monthlyExpenses[category] || 0;
                const percentage = (spent / budget) * 100;
                const categoryName = AppData.categories[category]?.name || category;
                const categoryColor = AppData.categories[category]?.color || '#95A5A6';
                
                html += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${categoryName}</span>
                            <span style="font-weight: 600;">R$ ${spent.toFixed(2)} / R$ ${budget.toFixed(2)}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%; background: ${categoryColor};"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--gray); margin-top: 5px;">
                            <span>${percentage.toFixed(0)}% utilizado</span>
                            <span>Restam R$ ${Math.max(0, budget - spent).toFixed(2)}</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ===================== NOVO: GRÁFICOS INTERATIVOS =====================
        function initializeCharts() {
            updateCharts();
        }

        function updateCharts() {
            const period = document.getElementById('chart-period')?.value || 'month';
            updateCategoriesChart(period);
            updatePeopleChart(period);
            updateMonthlyChart();
            updateStats();
        }

        function updateCategoriesChart(period = 'month') {
            const canvas = document.getElementById('categoriesChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (AppData.charts.categories) {
                AppData.charts.categories.destroy();
            }
            
            // Filtrar transações pelo período
            const filteredTransactions = filterTransactionsByPeriod(period);
            const expenseTransactions = filteredTransactions.filter(t => t.type === 'expense');
            
            // Agrupar por categoria
            const categoryTotals = {};
            expenseTransactions.forEach(transaction => {
                const categoryName = getCategoryName(transaction.category, 'expense');
                categoryTotals[categoryName] = (categoryTotals[categoryName] || 0) + transaction.amount;
            });
            
            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);
            const colors = Object.keys(categoryTotals).map(categoryName => {
                // Encontrar a cor da categoria
                const categoryKey = Object.keys(AppData.categories).find(key => 
                    AppData.categories[key].name === categoryName
                );
                return AppData.categories[categoryKey]?.color || '#95A5A6';
            });
            
            AppData.charts.categories = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: R$ ${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Atualizar legenda
            updateChartLegend('categoriesLegend', labels, colors, data);
        }

        function updatePeopleChart(period = 'month') {
            const canvas = document.getElementById('peopleChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (AppData.charts.people) {
                AppData.charts.people.destroy();
            }
            
            // Filtrar transações pelo período
            const filteredTransactions = filterTransactionsByPeriod(period);
            const expenseTransactions = filteredTransactions.filter(t => t.type === 'expense');
            
            // Agrupar por pessoa
            const peopleTotals = {};
            expenseTransactions.forEach(transaction => {
                const personName = getPersonName(transaction.person);
                peopleTotals[personName] = (peopleTotals[personName] || 0) + transaction.amount;
            });
            
            const labels = Object.keys(peopleTotals);
            const data = Object.values(peopleTotals);
            const colors = Object.keys(peopleTotals).map(personName => {
                // Encontrar a cor da pessoa
                const personKey = Object.keys(AppData.people).find(key => 
                    AppData.people[key].name === personName
                );
                return AppData.people[personKey]?.color || '#95A5A6';
            });
            
            AppData.charts.people = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Gastos por Pessoa',
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `R$ ${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Atualizar legenda
            updateChartLegend('peopleLegend', labels, colors, data);
        }

        function updateMonthlyChart() {
            const canvas = document.getElementById('monthlyChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destruir gráfico anterior se existir
            if (AppData.charts.monthly) {
                AppData.charts.monthly.destroy();
            }
            
            // Agrupar transações por mês
            const monthlyData = {};
            const now = new Date();
            const currentYear = now.getFullYear();
            
            // Últimos 6 meses
            const months = [];
            for (let i = 5; i >= 0; i--) {
                const date = new Date(currentYear, now.getMonth() - i, 1);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                const monthName = date.toLocaleDateString('pt-BR', { month: 'short' });
                months.push({ key: monthKey, name: monthName });
                monthlyData[monthKey] = { income: 0, expense: 0 };
            }
            
            // Calcular totais por mês
            AppData.transactions.forEach(transaction => {
                const transDate = new Date(transaction.date);
                const monthKey = `${transDate.getFullYear()}-${String(transDate.getMonth() + 1).padStart(2, '0')}`;
                
                if (monthlyData[monthKey]) {
                    if (transaction.type === 'income') {
                        monthlyData[monthKey].income += transaction.amount;
                    } else {
                        monthlyData[monthKey].expense += transaction.amount;
                    }
                }
            });
            
            const labels = months.map(m => m.name);
            const incomeData = months.map(m => monthlyData[m.key]?.income || 0);
            const expenseData = months.map(m => monthlyData[m.key]?.expense || 0);
            
            AppData.charts.monthly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Receitas',
                            data: incomeData,
                            borderColor: '#2ECC71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'Despesas',
                            data: expenseData,
                            borderColor: '#FF7A5A',
                            backgroundColor: 'rgba(255, 122, 90, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toFixed(2);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: R$ ${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function filterTransactionsByPeriod(period) {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            return AppData.transactions.filter(transaction => {
                const transDate = new Date(transaction.date);
                
                switch(period) {
                    case 'month':
                        return transDate.getMonth() === currentMonth && 
                               transDate.getFullYear() === currentYear;
                    
                    case 'last_month':
                        const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                        const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
                        return transDate.getMonth() === lastMonth && 
                               transDate.getFullYear() === lastMonthYear;
                    
                    case 'year':
                        return transDate.getFullYear() === currentYear;
                    
                    case 'all':
                    default:
                        return true;
                }
            });
        }

        function updateChartLegend(containerId, labels, colors, data) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const total = data.reduce((a, b) => a + b, 0);
            
            container.innerHTML = labels.map((label, index) => {
                const value = data[index];
                const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                return `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${colors[index]}"></div>
                        <span>${label}</span>
                        <span style="color: var(--gray); margin-left: auto;">
                            ${percentage}% (R$ ${value.toFixed(2)})
                        </span>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            // Média mensal
            const monthlyTotals = {};
            AppData.transactions.forEach(transaction => {
                const transDate = new Date(transaction.date);
                const monthKey = `${transDate.getFullYear()}-${transDate.getMonth()}`;
                
                if (!monthlyTotals[monthKey]) {
                    monthlyTotals[monthKey] = { income: 0, expense: 0 };
                }
                
                if (transaction.type === 'income') {
                    monthlyTotals[monthKey].income += transaction.amount;
                } else {
                    monthlyTotals[monthKey].expense += transaction.amount;
                }
            });
            
            const monthlyBalances = Object.values(monthlyTotals).map(m => m.income - m.expense);
            const avgMonthly = monthlyBalances.length > 0 
                ? monthlyBalances.reduce((a, b) => a + b, 0) / monthlyBalances.length 
                : 0;
            
            document.getElementById('avg-monthly').textContent = formatCurrency(avgMonthly);
            
            // Maior gasto
            const expenses = AppData.transactions.filter(t => t.type === 'expense');
            const maxExpense = expenses.length > 0 
                ? Math.max(...expenses.map(t => t.amount))
                : 0;
            
            document.getElementById('max-expense').textContent = formatCurrency(maxExpense);
            
            // Categoria mais usada
            const categoryCount = {};
            expenses.forEach(t => {
                categoryCount[t.category] = (categoryCount[t.category] || 0) + 1;
            });
            
            const mostUsed = Object.entries(categoryCount).sort((a, b) => b[1] - a[1])[0];
            document.getElementById('most-used-category').textContent = mostUsed 
                ? getCategoryName(mostUsed[0], 'expense') 
                : '-';
            
            // Dias restantes no mês
            const now = new Date();
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            const daysRemaining = lastDay.getDate() - now.getDate();
            document.getElementById('days-remaining').textContent = daysRemaining;
        }

        // ===================== NOVO: MULTIUSUÁRIO EXPANDIDO =====================
        function initializeUsers() {
            // Carregar usuários do localStorage ou usar os padrões
            updateUserSelects();
            renderUsersList();
            setupColorPicker();
        }

        function updateUserSelects() {
            // Atualizar todos os selects de pessoa
            const selects = [
                'transaction-person',
                'edit-person',
                'quick-person'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione...</option>';
                    
                    Object.entries(AppData.people).forEach(([key, person]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = person.name;
                        select.appendChild(option);
                    });
                }
            });
            
            // Atualizar cards de pessoas no dashboard
            updatePeopleCards();
        }

        function updatePeopleCards() {
            const container = document.getElementById('dashboard-people-cards');
            if (!container) return;
            
            // Calcular gastos por pessoa
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            const expensesByPerson = {};
            AppData.transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    const transDate = new Date(t.date);
                    if (transDate.getMonth() === currentMonth && transDate.getFullYear() === currentYear) {
                        expensesByPerson[t.person] = (expensesByPerson[t.person] || 0) + t.amount;
                    }
                });
            
            container.innerHTML = Object.entries(AppData.people).map(([key, person]) => {
                const spent = expensesByPerson[key] || 0;
                const iconClass = getPersonIconClass(person.icon);
                
                return `
                    <div class="person-card">
                        <div class="person-avatar" style="background: linear-gradient(135deg, ${person.color}, ${person.color}99);">
                            <i class="fas fa-${iconClass}"></i>
                        </div>
                        <div class="person-info">
                            <h3>${person.name}</h3>
                            <div class="person-expense">${formatCurrency(spent)}</div>
                            <div class="person-tags">${spent > 0 ? 'Gastos do mês' : 'Sem gastos este mês'}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getPersonIconClass(icon) {
            const icons = {
                'user': 'user',
                'child': 'child',
                'female': 'female',
                'male': 'male',
                'family': 'home',
                'pet': 'paw',
                'student': 'graduation-cap',
                'worker': 'hard-hat'
            };
            return icons[icon] || 'user';
        }

        function renderUsersList() {
            const container = document.getElementById('usersList');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.entries(AppData.people).forEach(([key, person]) => {
                const iconClass = getPersonIconClass(person.icon);
                const userCard = document.createElement('div');
                userCard.className = 'user-manage-card';
                userCard.innerHTML = `
                    <div class="person-avatar" style="background: linear-gradient(135deg, ${person.color}, ${person.color}99);">
                        <i class="fas fa-${iconClass}"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${person.name}</div>
                        <div style="font-size: 12px; color: var(--gray);">ID: ${key}</div>
                    </div>
                    <div class="user-manage-actions">
                        <button class="action-btn edit-btn" onclick="editUser('${key}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteUser('${key}')" 
                                ${['fabiana', 'marcos', 'family'].includes(key) ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(userCard);
            });
            
            // Adicionar card para novo usuário
            const addCard = document.createElement('div');
            addCard.className = 'user-manage-card add-user-btn';
            addCard.onclick = openManageUsersModal;
            addCard.innerHTML = `
                <i class="fas fa-user-plus fa-2x"></i>
                <div style="font-weight: 600;">Adicionar Usuário</div>
            `;
            container.appendChild(addCard);
        }

        function openManageUsersModal() {
            document.getElementById('manageUsersModal').classList.add('active');
            document.getElementById('new-user-name').value = '';
            document.getElementById('new-user-icon').value = 'user';
            
            // Selecionar primeira cor por padrão
            const colorBadges = document.querySelectorAll('.color-badge');
            if (colorBadges.length > 0) {
                colorBadges.forEach(badge => badge.classList.remove('selected'));
                colorBadges[0].classList.add('selected');
            }
        }

        function setupColorPicker() {
            const container = document.getElementById('colorPicker');
            if (!container) return;
            
            const colors = [
                '#9B59B6', '#3498DB', '#2ECC71', '#F1C40F', '#E74C3C',
                '#1ABC9C', '#8A2387', '#E94057', '#F27121', '#6A4CFF'
            ];
            
            container.innerHTML = colors.map(color => `
                <div class="color-badge" style="background: ${color};" 
                     data-color="${color}" onclick="selectColor(this)"></div>
            `).join('');
            
            // Selecionar primeira cor
            const firstBadge = container.querySelector('.color-badge');
            if (firstBadge) {
                firstBadge.classList.add('selected');
            }
        }

        function selectColor(element) {
            document.querySelectorAll('.color-badge').forEach(badge => {
                badge.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function addNewUser() {
            const nameInput = document.getElementById('new-user-name');
            const name = nameInput.value.trim();
            
            if (!name) {
                showNotification('Atenção', 'Digite um nome para o usuário', 'error');
                return;
            }
            
            // Verificar se já existe
            const exists = Object.values(AppData.people).some(person => 
                person.name.toLowerCase() === name.toLowerCase()
            );
            
            if (exists) {
                showNotification('Atenção', 'Já existe um usuário com este nome', 'error');
                return;
            }
            
            // Verificar limite de usuários
            if (Object.keys(AppData.people).length >= 10) {
                showNotification('Limite Atingido', 'Máximo de 10 usuários permitidos', 'error');
                return;
            }
            
            // Obter cor selecionada
            const selectedColor = document.querySelector('.color-badge.selected')?.getAttribute('data-color') || '#95A5A6';
            const icon = document.getElementById('new-user-icon').value;
            
            // Criar ID único
            const id = name.toLowerCase().replace(/[^a-z0-9]/g, '_') + '_' + Date.now();
            
            // Adicionar usuário
            AppData.people[id] = {
                name: name,
                color: selectedColor,
                icon: icon
            };
            
            // Salvar e atualizar
            saveToLocalStorage();
            updateUserSelects();
            renderUsersList();
            
            // Fechar modal
            document.getElementById('manageUsersModal').classList.remove('active');
            nameInput.value = '';
            
            showNotification('Usuário Adicionado', `${name} foi adicionado com sucesso!`, 'success');
        }

        function editUser(userId) {
            const person = AppData.people[userId];
            if (!person) return;
            
            const newName = prompt('Novo nome para o usuário:', person.name);
            if (!newName || newName.trim() === '') return;
            
            AppData.people[userId].name = newName.trim();
            
            saveToLocalStorage();
            updateUserSelects();
            renderUsersList();
            
            showNotification('Usuário Atualizado', 'Nome alterado com sucesso!', 'success');
        }

        function deleteUser(userId) {
            // Não permitir deletar usuários padrão
            if (['fabiana', 'marcos', 'family'].includes(userId)) {
                showNotification('Não Permitido', 'Não é possível remover usuários padrão', 'error');
                return;
            }
            
            // Verificar se o usuário tem transações
            const hasTransactions = AppData.transactions.some(t => t.person === userId);
            
            if (hasTransactions) {
                if (!confirm('Este usuário tem transações associadas. Deseja realmente removê-lo?\nAs transações serão mantidas, mas sem associação.')) {
                    return;
                }
            }
            
            const userName = AppData.people[userId]?.name;
            delete AppData.people[userId];
            
            saveToLocalStorage();
            updateUserSelects();
            renderUsersList();
            
            showNotification('Usuário Removido', `${userName} foi removido do sistema`, 'success');
        }

        // ===================== NOVO: SINCRONIZAÇÃO ENTRE DISPOSITIVOS =====================
        function generateSyncCode() {
            const syncData = {
                transactions: AppData.transactions,
                drafts: AppData.drafts,
                cards: AppData.cards,
                budgets: AppData.budgets,
                people: AppData.people,
                timestamp: new Date().toISOString(),
                device: navigator.userAgent.substring(0, 50)
            };
            
            const jsonString = JSON.stringify(syncData);
            const base64String = btoa(unescape(encodeURIComponent(jsonString)));
            
            // Dividir em chunks para facilitar leitura
            const chunkSize = 50;
            let formattedCode = '';
            for (let i = 0; i < base64String.length; i += chunkSize) {
                formattedCode += base64String.substring(i, i + chunkSize) + '\n';
            }
            
            document.getElementById('syncCode').textContent = formattedCode.trim();
            
            // Registrar no histórico
            AppData.syncHistory.push({
                type: 'export',
                timestamp: new Date().toISOString(),
                items: AppData.transactions.length
            });
            
            saveToLocalStorage();
            updateSyncHistory();
            
            showNotification('Código Gerado', 'Código de sincronização criado com sucesso', 'success');
        }

        function copySyncCode() {
            const code = document.getElementById('syncCode').textContent;
            if (code === 'Gerar código...') {
                showNotification('Atenção', 'Gere um código primeiro', 'error');
                return;
            }
            
            navigator.clipboard.writeText(code.replace(/\n/g, '')).then(() => {
                showNotification('Copiado', 'Código copiado para a área de transferência', 'success');
            });
        }

        function importSyncCode() {
            const codeInput = document.getElementById('importSyncCode');
            const code = codeInput.value.replace(/\s/g, '');
            
            if (!code) {
                showNotification('Atenção', 'Cole um código de sincronização', 'error');
                return;
            }
            
            try {
                const jsonString = decodeURIComponent(escape(atob(code)));
                const syncData = JSON.parse(jsonString);
                
                if (!confirm('Importar dados de outro dispositivo?\nIsso substituirá seus dados locais.')) {
                    return;
                }
                
                // Importar dados
                AppData.transactions = syncData.transactions || [];
                AppData.drafts = syncData.drafts || [];
                AppData.cards = syncData.cards || [];
                AppData.budgets = syncData.budgets || {};
                
                // Mesclar usuários (não substituir)
                if (syncData.people) {
                    Object.entries(syncData.people).forEach(([key, person]) => {
                        if (!AppData.people[key]) {
                            AppData.people[key] = person;
                        }
                    });
                }
                
                // Registrar no histórico
                AppData.syncHistory.push({
                    type: 'import',
                    timestamp: new Date().toISOString(),
                    items: AppData.transactions.length,
                    source: syncData.device || 'Dispositivo desconhecido'
                });
                
                saveToLocalStorage();
                updateAllViews();
                
                codeInput.value = '';
                
                showNotification('Sincronização Concluída', 'Dados importados com sucesso', 'success');
                
            } catch (error) {
                console.error('Erro ao importar código:', error);
                showNotification('Erro', 'Código inválido ou corrompido', 'error');
            }
        }

        function updateSyncHistory() {
            const container = document.getElementById('sync-history');
            if (!container) return;
            
            if (AppData.syncHistory.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        <i class="fas fa-sync fa-2x" style="margin-bottom: 10px;"></i>
                        <p>Nenhuma sincronização realizada</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = AppData.syncHistory.slice().reverse().map(entry => `
                <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--gray-light);">
                    <div>
                        <i class="fas fa-${entry.type === 'export' ? 'upload' : 'download'}"></i>
                        <span style="font-weight: 600; margin-left: 8px;">
                            ${entry.type === 'export' ? 'Exportado' : 'Importado'} 
                            ${entry.items} itens
                        </span>
                        ${entry.source ? `<div style="font-size: 12px; color: var(--gray);">De: ${entry.source}</div>` : ''}
                    </div>
                    <div style="font-size: 12px; color: var(--gray);">
                        ${new Date(entry.timestamp).toLocaleDateString('pt-BR')}
                    </div>
                </div>
            `).join('');
        }

        // ===================== NOVO: MODO RÁPIDO DE LANÇAMENTO =====================
        function setupQuickAdd() {
            document.getElementById('quickAddBtn').addEventListener('click', openQuickModal);
            document.getElementById('closeQuickModal').addEventListener('click', closeQuickModal);
            document.getElementById('cancelQuickBtn').addEventListener('click', closeQuickModal);
            
            document.getElementById('quick-transaction-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveQuickTransaction();
            });
            
            // Configurar categoria automática
            document.getElementById('quick-description').addEventListener('input', function() {
                autoCategorize(this.value);
            });
        }

        function openQuickModal() {
            // Preencher data atual
            document.getElementById('quickModal').classList.add('active');
            document.getElementById('quick-description').focus();
        }

        function closeQuickModal() {
            document.getElementById('quickModal').classList.remove('active');
            document.getElementById('quick-transaction-form').reset();
        }

        function autoCategorize(description) {
            const desc = description.toLowerCase();
            
            // Mapeamento de palavras-chave para categorias
            const keywordMap = {
                'food': ['mercado', 'supermercado', 'restaurante', 'padaria', 'açougue', 'hortifruti', 'feira', 'lanche', 'pizza', 'hamburguer', 'comida'],
                'home': ['aluguel', 'condomínio', 'luz', 'água', 'gás', 'internet', 'telefone', 'netflix', 'spotify', 'streaming', 'contas'],
                'transport': ['combustível', 'gasolina', 'ônibus', 'uber', '99', 'taxi', 'estacionamento', 'pedágio', 'manutenção', 'oficina'],
                'education': ['escola', 'faculdade', 'curso', 'livro', 'material', 'mensalidade', 'universidade'],
                'health': ['médico', 'hospital', 'farmácia', 'remédio', 'plano de saúde', 'consulta', 'exame'],
                'fun': ['cinema', 'shopping', 'parque', 'viagem', 'hotel', 'passagem', 'show', 'teatro'],
                'clothes': ['roupa', 'calça', 'camisa', 'vestido', 'sapato', 'tenis', 'loja', 'shopping'],
                'salary': ['salário', 'pagamento', 'renda', 'proventos'],
                'extra': ['freela', 'freelancer', 'bico', 'extra', 'adicional'],
                'gift': ['presente', 'doação', 'contribuição']
            };
            
            // Encontrar categoria correspondente
            for (const [category, keywords] of Object.entries(keywordMap)) {
                if (keywords.some(keyword => desc.includes(keyword))) {
                    // Se for uma despesa, atualizar o tipo
                    if (['food', 'home', 'transport', 'education', 'health', 'fun', 'clothes'].includes(category)) {
                        document.getElementById('quick-type').value = 'expense';
                    } else {
                        document.getElementById('quick-type').value = 'income';
                    }
                    return;
                }
            }
        }

        function saveQuickTransaction() {
            const description = document.getElementById('quick-description').value.trim();
            const amount = parseFloat(document.getElementById('quick-amount').value);
            const type = document.getElementById('quick-type').value;
            const person = document.getElementById('quick-person').value;
            
            if (!description || !amount || !person) {
                showNotification('Atenção', 'Preencha todos os campos!', 'error');
                return;
            }
            
            // Determinar categoria automaticamente
            let category = 'other';
            if (type === 'income') {
                category = 'salary'; // Padrão para receitas
            }
            
            const newTransaction = {
                id: Date.now(),
                description,
                amount,
                category,
                person,
                date: new Date().toISOString().split('T')[0],
                payment: 'cash', // Padrão para modo rápido
                type: type
            };
            
            AppData.transactions.push(newTransaction);
            
            saveToLocalStorage();
            updateDashboard();
            updateAllViews();
            
            closeQuickModal();
            
            showNotification('Transação Rápida', `${type === 'income' ? 'Receita' : 'Despesa'} lançada com sucesso!`, 'success');
        }

        // ===================== FUNÇÕES RESTANTES (mantidas do original) =====================
        function renderDrafts(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (AppData.drafts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: var(--gray);">
                        <i class="fas fa-edit fa-2x" style="margin-bottom: 10px;"></i>
                        <p>Nenhum rascunho salvo</p>
                        <p style="font-size: 13px; margin-top: 5px;">Use o botão "SALVAR RASCUNHO" para guardar rascunhos</p>
                    </div>
                `;
                return;
            }
            
            const sortedDrafts = [...AppData.drafts].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            container.innerHTML = sortedDrafts.map(draft => `
                <div class="draft-item">
                    <div class="draft-info">
                        <h4>${draft.description}</h4>
                        <p>
                            ${formatCurrency(draft.amount)} • 
                            ${getCategoryName(draft.category, draft.type)} • 
                            ${getPersonName(draft.person)} • 
                            ${draft.date}
                        </p>
                        <small style="color: ${draft.type === 'income' ? 'var(--green)' : 'var(--primary)'};">
                            ${draft.type === 'income' ? 'Receita' : 'Despesa'} • Salvo em ${new Date(draft.createdAt).toLocaleDateString('pt-BR')}
                        </small>
                    </div>
                    <div class="draft-actions">
                        <button class="draft-btn draft-complete" onclick="completeDraft(${draft.id})">
                            <i class="fas fa-check"></i> Completar
                        </button>
                        <button class="draft-btn draft-delete" onclick="deleteDraft(${draft.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderCategories() {
            const container = document.getElementById('categories-container');
            if (!container) return;
            
            const expensesByCategory = {};
            AppData.transactions
                .filter(t => t.type === 'expense')
                .forEach(t => {
                    expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
                });
            
            container.innerHTML = Object.entries(AppData.categories).map(([key, category]) => {
                const spent = expensesByCategory[key] || 0;
                const percentage = Math.min(Math.round((spent / category.limit) * 100), 100);
                
                return `
                    <div class="category-card">
                        <div class="category-header">
                            <div class="category-icon" style="background: linear-gradient(135deg, ${category.color}, ${category.color}99);">
                                <i class="fas fa-${category.icon}"></i>
                            </div>
                            <div class="category-name">${category.name}</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%; background: linear-gradient(to right, ${category.color}, ${category.color}99);"></div>
                        </div>
                        <div class="category-details">
                            <div class="category-amount">${formatCurrency(spent)}</div>
                            <div class="category-limit">Limite: ${formatCurrency(category.limit)}</div>
                        </div>
                        <div style="margin-top: 10px; font-size: 13px; color: ${percentage >= 80 ? '#E74C3C' : 'var(--gray)'};">
                            <i class="fas fa-${percentage >= 80 ? 'exclamation-triangle' : 'info-circle'}"></i> 
                            ${percentage}% utilizado • Restam ${formatCurrency(category.limit - spent)}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function saveDraft() {
            const type = document.querySelector('.type-btn.active').getAttribute('data-type');
            const description = document.getElementById('transaction-description').value.trim();
            const amount = document.getElementById('transaction-amount').value;
            const category = type === 'expense' 
                ? document.getElementById('expense-category').value
                : document.getElementById('income-category').value;
            const person = document.getElementById('transaction-person').value;
            const date = document.getElementById('transaction-date').value;
            const payment = document.getElementById('transaction-payment').value;
            
            if (!description || !amount || !category || !person || !date || !payment) {
                showNotification('Atenção', 'Preencha todos os campos antes de salvar!', 'error');
                return;
            }
            
            const newDraft = {
                id: Date.now(),
                description,
                amount: parseFloat(amount),
                category,
                person,
                date,
                payment,
                type: type,
                status: 'draft',
                createdAt: new Date().toISOString()
            };
            
            AppData.drafts.push(newDraft);
            
            // Limpar formulário
            document.getElementById('transaction-form').reset();
            document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
            
            // Resetar para despesa
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-type') === 'expense') {
                    btn.classList.add('active');
                }
            });
            document.getElementById('expense-categories').style.display = 'block';
            document.getElementById('income-categories').style.display = 'none';
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-check"></i> LANÇAR TRANSAÇÃO';
            document.getElementById('submit-btn').className = 'form-submit';
            
            // Salvar dados
            saveToLocalStorage();
            
            // Atualizar UI
            renderDrafts('drafts-list-daily');
            
            showNotification('Rascunho Salvo', 'Rascunho salvo com sucesso!', 'success');
        }

        function completeDraft(draftId) {
            const draftIndex = AppData.drafts.findIndex(d => d.id === draftId);
            if (draftIndex === -1) return;
            
            const draft = AppData.drafts[draftIndex];
            
            // Remover do status de rascunho
            delete draft.status;
            delete draft.createdAt;
            
            // Adicionar às transações
            draft.id = Date.now();
            AppData.transactions.push(draft);
            
            // Remover dos rascunhos
            AppData.drafts.splice(draftIndex, 1);
            
            // Atualizar tudo
            saveToLocalStorage();
            updateDashboard();
            renderTransactions('recent-transactions', AppData.transactions.slice(0, 10));
            renderPeopleDetails();
            renderCategories();
            renderTransactions('all-transactions', AppData.transactions);
            renderDrafts('drafts-list-daily');
            
            showNotification('Transação Completa', 'Transação completada com sucesso!', 'success');
        }

        function deleteDraft(draftId) {
            if (confirm('Tem certeza que deseja excluir este rascunho?')) {
                AppData.drafts = AppData.drafts.filter(d => d.id !== draftId);
                
                saveToLocalStorage();
                renderDrafts('drafts-list-daily');
                
                showNotification('Rascunho Excluído', 'Rascunho excluído com sucesso!', 'success');
            }
        }

        // ===================== BACKUP E EXPORTAÇÃO =====================
        function exportToJSON() {
            const data = {
                appData: {
                    transactions: AppData.transactions,
                    drafts: AppData.drafts,
                    cards: AppData.cards,
                    budgets: AppData.budgets,
                    users: AppData.users,
                    people: AppData.people,
                    syncHistory: AppData.syncHistory,
                    stats: AppData.stats
                },
                exportDate: new Date().toISOString(),
                version: '4.0-local'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `nosso-controle-backup-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Backup Exportado', 'Arquivo JSON gerado com sucesso', 'success');
        }

        function exportToExcel() {
            if (AppData.transactions.length === 0) {
                showNotification('Nenhum Dado', 'Não há transações para exportar', 'error');
                return;
            }
            
            let csvContent = "Data,Descrição,Tipo,Pessoa,Categoria,Valor,Forma de Pagamento\n";
            
            AppData.transactions.forEach(transaction => {
                const row = [
                    transaction.date,
                    `"${transaction.description}"`,
                    transaction.type === 'income' ? 'Receita' : 'Despesa',
                    getPersonName(transaction.person),
                    getCategoryName(transaction.category, transaction.type),
                    transaction.amount,
                    getPaymentName(transaction.payment)
                ].join(',');
                
                csvContent += row + "\n";
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            link.setAttribute("href", url);
            link.setAttribute("download", `transacoes-${new Date().toISOString().split('T')[0]}.csv`);
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Exportado para CSV', 'Arquivo pronto para abrir no Excel', 'success');
        }

        function importFromJSON() {
            if (!confirm('Importar dados substituirá os dados atuais. Continuar?')) {
                return;
            }
            
            document.getElementById('fileImport').click();
        }

        document.getElementById('fileImport').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.appData) {
                        throw new Error('Arquivo inválido');
                    }
                    
                    AppData.transactions = importedData.appData.transactions || [];
                    AppData.drafts = importedData.appData.drafts || [];
                    AppData.cards = importedData.appData.cards || [];
                    AppData.budgets = importedData.appData.budgets || {};
                    AppData.users = importedData.appData.users || {};
                    AppData.people = importedData.appData.people || AppData.people;
                    AppData.syncHistory = importedData.appData.syncHistory || [];
                    AppData.stats = importedData.appData.stats || { lastSave: null, saveCount: 0 };
                    
                    saveToLocalStorage();
                    
                    updateDashboard();
                    renderTransactions('recent-transactions', AppData.transactions.slice(0, 10));
                    renderPeopleDetails();
                    renderCategories();
                    renderTransactions('all-transactions', AppData.transactions);
                    renderDrafts('drafts-list-daily');
                    renderCards();
                    
                    // Atualizar novos sistemas
                    setupBudgets();
                    initializeCharts();
                    initializeUsers();
                    
                    showNotification('Backup Importado', 'Dados restaurados com sucesso', 'success');
                    
                } catch (error) {
                    console.error('Erro ao importar:', error);
                    showNotification('Erro na Importação', 'Arquivo corrompido ou inválido', 'error');
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        });

        function clearData() {
            if (confirm('⚠️ ATENÇÃO: Isso apagará TODOS os dados. Tem certeza?')) {
                AppData.transactions = [];
                AppData.drafts = [];
                AppData.cards = [];
                AppData.budgets = {};
                AppData.users = {};
                AppData.people = {
                    fabiana: { name: "Fabiana", color: "#9B59B6", icon: "female" },
                    marcos: { name: "Marcos", color: "#3498DB", icon: "male" },
                    family: { name: "Família", color: "#2ECC71", icon: "home" }
                };
                AppData.syncHistory = [];
                AppData.stats = { lastSave: null, saveCount: 0 };
                
                localStorage.removeItem('nossoControle');
                
                updateDashboard();
                renderTransactions('recent-transactions', []);
                renderPeopleDetails();
                renderCategories();
                renderTransactions('all-transactions', []);
                renderDrafts('drafts-list-daily');
                renderCards();
                
                // Atualizar novos sistemas
                setupBudgets();
                initializeCharts();
                initializeUsers();
                
                showNotification('Dados Limpos', 'Todos os dados foram removidos', 'success');
            }
        }

        // ===================== SISTEMA DE NAVEGAÇÃO =====================
        function showSection(sectionId) {
            // Fechar menu mobile
            document.getElementById('sidebarMobile').classList.remove('active');
            document.getElementById('sidebarOverlay').classList.remove('active');
            
            // Ocultar todas as seções
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.classList.add('active');
                
                // Atualizar menu ativo
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-section') === sectionId) {
                        item.classList.add('active');
                    }
                });
                
                // Carregar dados da seção
                loadSectionData(sectionId);
                
                // Scroll suave para o topo
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function loadSectionData(sectionId) {
            switch(sectionId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'budget':
                    checkBudgetAlerts();
                    renderBudgetSummary();
                    break;
                case 'reports':
                    updateCharts();
                    break;
                case 'users':
                    renderUsersList();
                    break;
                case 'sync':
                    updateSyncHistory();
                    break;
                case 'daily':
                    renderTransactions('recent-transactions', AppData.transactions.slice(0, 10));
                    renderDrafts('drafts-list-daily');
                    break;
                case 'people':
                    renderPeopleDetails();
                    break;
                case 'categories':
                    renderCategories();
                    break;
                case 'transactions':
                    renderTransactions('all-transactions', AppData.transactions);
                    break;
                case 'storage':
                    updateSaveStatus();
                    break;
            }
        }

        // ===================== FORMULÁRIO =====================
        function setupTypeToggle(formId = 'transaction-form') {
            const typeBtns = document.querySelectorAll(`#${formId} .type-btn`);
            const expenseCategories = document.getElementById(formId === 'transaction-form' ? 'expense-categories' : 'edit-expense-categories');
            const incomeCategories = document.getElementById(formId === 'transaction-form' ? 'income-categories' : 'edit-income-categories');
            const submitBtn = formId === 'transaction-form' ? document.getElementById('submit-btn') : null;
            
            typeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    typeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const type = this.getAttribute('data-type');
                    
                    if (type === 'expense') {
                        if (expenseCategories) expenseCategories.style.display = 'block';
                        if (incomeCategories) incomeCategories.style.display = 'none';
                        if (submitBtn) {
                            submitBtn.innerHTML = '<i class="fas fa-check"></i> LANÇAR TRANSAÇÃO';
                            submitBtn.className = 'form-submit';
                        }
                    } else {
                        if (expenseCategories) expenseCategories.style.display = 'none';
                        if (incomeCategories) incomeCategories.style.display = 'block';
                        if (submitBtn) {
                            submitBtn.innerHTML = '<i class="fas fa-check"></i> LANÇAR TRANSAÇÃO';
                            submitBtn.className = 'form-submit income';
                        }
                    }
                });
            });
        }

        document.getElementById('transaction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = document.querySelector('.type-btn.active').getAttribute('data-type');
            const description = document.getElementById('transaction-description').value.trim();
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const category = type === 'expense' 
                ? document.getElementById('expense-category').value
                : document.getElementById('income-category').value;
            const person = document.getElementById('transaction-person').value;
            const date = document.getElementById('transaction-date').value;
            const payment = document.getElementById('transaction-payment').value;
            
            if (!description || !amount || !category || !person || !date || !payment) {
                showNotification('Atenção', 'Preencha todos os campos!', 'error');
                return;
            }
            
            const newTransaction = {
                id: Date.now(),
                description,
                amount,
                category,
                person,
                date,
                payment,
                type: type
            };
            
            AppData.transactions.push(newTransaction);
            
            saveToLocalStorage();
            updateDashboard();
            
            this.reset();
            document.getElementById('transaction-date').value = new Date().toISOString().split('T')[0];
            
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-type') === 'expense') {
                    btn.classList.add('active');
                }
            });
            document.getElementById('expense-categories').style.display = 'block';
            document.getElementById('income-categories').style.display = 'none';
            document.getElementById('submit-btn').innerHTML = '<i class="fas fa-check"></i> LANÇAR TRANSAÇÃO';
            document.getElementById('submit-btn').className = 'form-submit';
            
            showNotification('Transação Lançada', `${type === 'income' ? 'Receita' : 'Despesa'} lançada com sucesso!`, 'success');
            
            renderTransactions('recent-transactions', AppData.transactions.slice(0, 10));
            renderDrafts('drafts-list-daily');
        });

        // ===================== MENU MOBILE FIX =====================
        function setupMobileMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebarMobile');
            const overlay = document.getElementById('sidebarOverlay');
            
            menuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                sidebar.classList.toggle('active');
                overlay.classList.toggle('active');
            });
            
            overlay.addEventListener('click', function() {
                sidebar.classList.remove('active');
                this.classList.remove('active');
            });
            
            document.addEventListener('click', function(e) {
                if (!sidebar.contains(e.target) && !menuToggle.contains(e.target) && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                }
            });
            
            // Menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    
                    setTimeout(() => {
                        showSection(sectionId);
                    }, 300);
                });
            });
        }

        // ===================== MODAL CONTROLS =====================
        function setupModalControls() {
            // Fechar modal
            document.getElementById('closeModal').addEventListener('click', closeEditModal);
            document.getElementById('cancelEditBtn').addEventListener('click', closeEditModal);
            
            // Salvar edição
            document.getElementById('saveEditBtn').addEventListener('click', saveEditedTransaction);
            
            // Excluir transação
            document.getElementById('deleteTransactionBtn').addEventListener('click', function() {
                if (AppData.editingTransaction && confirm('Tem certeza que deseja excluir esta transação?')) {
                    deleteTransaction(AppData.editingTransaction.id);
                    closeEditModal();
                }
            });
            
            // Fechar modal ao clicar fora
            document.getElementById('editModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditModal();
                }
            });
            
            // NOVO: Controles do modal rápido
            document.getElementById('closeQuickModal').addEventListener('click', closeQuickModal);
            document.getElementById('cancelQuickBtn').addEventListener('click', closeQuickModal);
            
            // NOVO: Controles do modal de usuários
            document.getElementById('closeManageUsersModal').addEventListener('click', function() {
                document.getElementById('manageUsersModal').classList.remove('active');
            });
            
            // NOVO: Botão adicionar usuário
            document.getElementById('addUserBtn').addEventListener('click', addNewUser);
        }

        // ===================== INICIALIZAÇÃO =====================
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar data atual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transaction-date').value = today;
            document.getElementById('edit-date').value = today;
            
            // Configurar menu mobile
            setupMobileMenu();
            
            // Configurar controles do modal
            setupModalControls();
            
            // Carregar dados
            loadFromLocalStorage();
            
            // Configurar toggle despesa/receita
            setupTypeToggle('transaction-form');
            setupTypeToggle('edit-transaction-form');
            
            // Configurar botão salvar rascunho
            document.getElementById('save-draft-btn').addEventListener('click', saveDraft);
            
            // NOVO: Inicializar sistemas adicionais
            setupBudgets();
            initializeCharts();
            initializeUsers();
            setupQuickAdd();
            
            // Inicializar dados
            updateDashboard();
            renderTransactions('recent-transactions', AppData.transactions.slice(0, 10));
            renderPeopleDetails();
            renderCategories();
            renderTransactions('all-transactions', AppData.transactions);
            renderDrafts('drafts-list-daily');
            renderCards();
            
            // Backup automático a cada 2 minutos
            setInterval(() => {
                if (AppData.transactions.length > 0 || AppData.drafts.length > 0 || AppData.cards.length > 0) {
                    saveToLocalStorage();
                    console.log('Backup automático realizado');
                }
            }, 120000); // 2 minutos
            
            // Backup antes de fechar a página
            window.addEventListener('beforeunload', function() {
                saveToLocalStorage();
            });
            
            // Mostrar notificação de boas-vindas
            setTimeout(() => {
                if (AppData.transactions.length === 0) {
                    showNotification(
                        'Bem-vindo ao Nosso Controle!', 
                        'Use o botão + para lançamentos rápidos', 
                        'success'
                    );
                } else {
                    showNotification(
                        'Dados Carregados', 
                        `${AppData.transactions.length} transações restauradas`, 
                        'success'
                    );
                }
            }, 1000);
        });
    </script>
</body>
</html>